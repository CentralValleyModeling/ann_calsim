module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/0.020545,-0.092768,-0.253169,-0.191123,-0.048876,0.114074,-0.912654,0.271671, &
            0.055941,-0.042940,0.061859,-0.031495,-0.572920,-0.045618,-0.623853,-0.109208, &
            0.016801,-0.024815,0.078272,-0.055507,-0.598352,-0.033365,-0.655592,-0.032072, &
            0.057736,-0.137172,0.113230,-0.211480,-0.415078,-0.045659,-0.726129,-0.077897, &
            0.015257,-0.020010,0.173339,0.078820,-0.241623,-0.000101,-0.495794,0.136910, &
            -0.003027,-0.062756,-0.109853,0.057728,-0.223326,0.044947,-0.070096,-0.118048, &
            0.000562,-0.060183,-0.153044,-0.051105,-0.036536,0.056506,-0.084142,-0.038405, &
            -0.016841,-0.153403,-0.250019,-0.337699,-0.016824,0.073007,-0.262689,-0.123521, &
            0.060659,-0.268462,0.857597,-0.984548,0.191673,0.116292,0.387408,1.596089, &
            0.101636,-0.377526,0.331514,-0.759296,-0.095900,0.033467,-0.281876,0.355482, &
            0.016682,0.143181,0.031134,0.632189,-0.094100,-0.170149,-0.006182,-0.830699, &
            0.077993,0.103126,0.345650,0.187670,0.077356,-0.159050,0.221016,-0.140015, &
            -0.030896,-0.094307,-0.072058,-0.408027,-0.315644,0.171423,-0.181105,0.925571, &
            0.000692,-0.429045,-0.221741,-0.396094,-0.359557,0.197585,-0.079633,0.452129, &
            0.130859,-0.517298,-0.315393,-0.297399,-0.433554,0.075600,-0.132487,1.168900, &
            -0.007955,-0.517962,-2.009616,-0.089577,0.065419,0.506474,-0.072820,0.084202, &
            -0.183366,0.055600,-2.243620,-0.241348,0.261128,0.487038,0.418570,-0.103132, &
            0.185435,-0.267801,-2.259837,-0.198408,0.345867,0.085954,-0.386546,0.519814, &
            -0.080977,0.244853,-0.456546,0.836520,-0.262580,-0.004446,0.417927,-0.561128, &
            0.117173,0.031718,0.125887,0.352294,0.076434,0.032781,-0.004127,-1.176099, &
            0.129843,-0.031590,-0.003976,0.007732,0.273704,-0.033561,-0.054930,-0.897781, &
            0.184262,0.061320,-0.115373,0.028608,0.466830,-0.139020,-0.168685,-0.304969, &
            0.157011,0.087354,-0.014510,-0.055270,0.521732,0.161040,0.125586,0.100934, &
            0.207357,0.061607,0.035995,-0.001318,0.599996,0.091798,0.024839,0.542973, &
            0.156581,-0.078133,-0.388329,0.051482,0.402617,0.353813,0.079031,0.352669, &
            0.267290,-0.080311,0.000418,0.420812,0.239718,0.462549,0.550001,0.298544, &
            0.299989,0.312948,0.093274,-0.728456,0.328606,-0.261027,1.604799,0.442568, &
            0.366653,0.217145,0.933818,-0.090136,0.027064,0.167689,1.219386,-0.095207, &
            0.542250,0.258626,2.300368,0.015965,0.909917,-0.390285,0.210260,-0.472586, &
            0.166380,0.095506,0.373732,0.500425,-0.097445,-0.163090,-0.476500,-1.428472, &
            0.018339,0.279157,-0.316915,1.129894,0.188990,0.019344,-2.230450,-1.629929, &
            0.099778,0.087451,-0.842354,0.831276,0.901900,0.147934,-0.173789,-1.819077, &
            -0.169100,0.507078,0.167072,0.157126,-0.553138,-0.134109,0.019779,-1.496056, &
            0.116437,-0.059589,0.592124,0.175319,-0.416738,-0.154330,-2.696393,-0.240509, &
            0.218547,-0.567495,0.150941,-0.076551,-0.412137,0.034689,-0.870417,-0.760831, &
            0.147380,-0.126004,-0.868091,0.005566,-0.334041,-0.286437,-1.725131,-0.392536, &
            -4.803984,3.029293,-0.945884,1.500141,-3.800738,-5.100466,-3.100907,-2.269664, &
            -4.802064,3.230649,-0.870210,1.429807,-3.676331,-4.908574,-3.814079,-1.913054, &
            -4.541843,3.141399,-1.148333,1.654602,-3.899027,-4.771528,-3.445204,-1.951455, &
            -4.600811,3.465313,-1.679052,1.716915,-4.233996,-4.194993,-3.049195,-1.568713, &
            -4.504603,3.280802,-1.407542,1.435034,-4.197765,-4.078881,-2.937468,-1.429471, &
            -4.537057,3.192111,-1.640102,1.543597,-4.064417,-4.116939,-2.846143,-1.167944, &
            -4.792767,2.915379,-1.514617,1.736498,-3.726822,-4.617283,-2.682607,-1.071228, &
            -4.871050,2.559591,-1.512457,1.325686,-3.627877,-4.769438,-2.798491,-0.984905, &
            -6.650119,0.650389,-0.166073,1.658106,-1.371049,-6.163106,-3.498882,0.502642, &
            -6.189055,0.939062,-0.643709,-0.399729,-1.591623,-4.781210,-1.443513,0.061761, &
            -4.817079,1.210067,-1.194532,-1.141303,-2.418703,-3.132146,0.385102,-0.423560, &
            -3.042270,1.896621,-2.785109,0.007551,-2.494186,-1.959226,0.251361,-0.633938, &
            -1.961390,2.242590,-2.563688,0.843652,-1.928524,-1.008491,-0.494619,-0.209764, &
            -1.174100,2.197236,-1.976508,1.227265,-0.887454,-0.165247,-1.160850,-0.432764, &
            -0.860960,1.561948,-1.795558,1.254343,-0.124123,-0.283333,-1.187396,-0.850432, &
            -0.667468,1.374684,-1.812196,1.281109,0.478970,-0.485076,-1.358311,-0.368112, &
            -0.624190,1.287568,-1.556743,0.700925,-0.042899,-0.297910,-0.845853,-0.609815, &
            -1.015566,1.364976,-1.391816,0.011027,-0.578090,-0.732311,-0.412920,-0.999427, &
            -1.023090,0.952648,-0.716748,0.416455,-1.201709,-0.513608,-1.301169,-1.574612, &
            -0.959044,0.816839,-0.756102,0.502271,-0.797941,-0.430026,-1.114099,-1.319490, &
            -0.876739,0.630843,-0.857096,0.569042,-1.022746,-0.260224,-1.011154,-1.487785, &
            -0.923661,0.523848,-0.758834,0.259568,-0.841527,-0.226424,-0.963143,-1.319018, &
            -1.146981,0.216816,-0.724730,0.656766,-1.175977,-0.440188,-0.704974,-1.319540, &
            -0.882668,0.277175,-0.830409,0.433563,-1.059602,-0.399834,-0.738312,-1.405853, &
            -0.940187,0.272990,-0.588388,0.324093,-0.902445,-0.170536,-0.588680,-1.126739, &
            -1.248277,-0.225347,-0.479334,0.700692,-0.899254,-0.050445,-0.657257,-1.320957, &
            -1.020709,-0.091380,-0.292828,0.449147,-0.680478,-0.292391,-0.611353,-1.593897, &
            -1.281621,-0.177142,-0.359049,0.239442,-0.141911,-0.138649,-0.915079,-1.362299, &
            -1.145716,0.333457,-0.476025,0.130530,-0.399808,0.360365,-1.328234,-1.330052, &
            -0.718389,0.607876,-1.302120,0.525679,0.074968,0.145588,-1.739903,-0.628017, &
            -0.394064,0.497674,-1.109886,0.200362,-0.241360,0.400395,-1.016428,-1.482081, &
            -0.067646,0.167417,-0.324478,-0.038535,-0.188278,0.223026,-0.390280,-1.770963, &
            -0.176747,-0.000106,-0.212109,0.090281,-0.592638,0.498415,-0.274086,-1.793350, &
            -0.255565,-0.073585,0.108083,0.113654,-0.925299,0.166475,0.019894,-0.916946, &
            -0.366018,0.608277,0.060135,-0.253512,-0.784163,0.127222,-0.145774,-0.543986, &
            -0.409171,0.309970,1.428348,0.391090,-0.998642,0.002566,-0.186039,-0.173910, &
            0.245936,-0.005826,0.381955,0.233719,-0.301950,0.450056,-0.366321,0.900725, &
            0.073211,-0.155726,-0.116929,-0.284980,-0.077222,0.065240,0.078654,0.900041, &
            0.058264,-0.019326,0.017642,-0.199376,0.017629,0.053579,0.106543,0.608412, &
            0.012979,-0.104755,0.085591,-0.167554,0.202308,0.099599,0.074325,0.254926, &
            0.093195,-0.033384,0.264259,0.118489,0.274011,0.062811,-0.063048,0.253653, &
            0.041434,-0.167371,0.109859,0.050484,0.157281,0.059425,-0.408771,0.162051, &
            -0.109662,0.231486,0.161225,-0.083406,-0.032641,-0.078314,-0.129758,0.082246, &
            -0.143103,0.124727,0.595903,0.153022,-0.235844,0.040945,0.006161,-0.156262, &
            0.260692,0.406147,1.118971,0.584990,0.566981,0.516313,0.037134,-0.231912, &
            -0.323039,-0.005060,0.851967,0.560797,0.901987,-0.753775,-0.268628,0.174329, &
            0.521207,0.392420,-0.144425,0.224394,0.415004,0.040390,0.525938,-0.369145, &
            0.289222,0.144151,0.131145,0.453383,0.679396,-0.729583,-0.369741,0.125070, &
            0.310848,0.804805,-0.583735,0.044111,-0.518898,-0.789474,1.573189,-0.167191, &
            -0.064978,0.135967,0.021697,0.361719,0.660197,-0.894844,-0.400989,-0.450233, &
            0.717710,-0.028009,-0.419816,0.385239,0.264154,0.323787,0.434920,-0.265805, &
            -0.018162,-0.689167,-1.303895,0.681327,1.777686,-0.020224,0.581029,0.303021, &
            -0.485275,0.382512,-0.372375,0.423019,0.357329,0.066049,0.252302,-0.274572, &
            -0.366430,0.062671,-0.648157,0.499270,1.008741,0.077340,0.464330,-0.110960, &
            0.179324,-0.522535,-0.238848,-0.097241,-0.131791,-0.138681,1.112890,0.747115, &
            0.331321,-0.605130,-0.323005,-0.357388,-0.216354,0.028784,0.863001,0.655918, &
            0.239042,-0.539651,-0.216732,-0.361889,-0.001768,-0.118621,0.809433,0.511095, &
            0.180588,-0.355099,0.016309,-0.532532,0.350013,-0.095493,0.490081,0.166484, &
            0.364657,-0.618342,-0.219856,-0.344213,0.654433,0.115709,0.510849,0.242276, &
            0.180279,-0.351908,0.051283,-0.396726,0.397148,0.068279,0.236049,0.134831, &
            0.199269,-0.476292,0.177614,-0.491726,0.531275,0.312814,0.127586,0.208252, &
            0.310167,-0.300760,0.098432,-0.230983,0.531768,0.355493,0.225391,0.371864, &
            0.583512,-0.360671,0.170724,0.459392,0.394178,0.298694,0.080336,0.358592, &
            0.740463,-0.261152,0.396947,0.637103,0.424362,0.290651,0.099227,0.560611, &
            0.412680,-0.422620,0.591517,0.758725,0.425604,-0.129530,0.108908,0.412605, &
            0.414714,-0.455291,0.591963,0.334435,-0.124242,-0.132790,0.775749,0.069356, &
            0.369506,-0.701573,0.749506,0.393854,0.261784,0.020231,0.329582,-0.160119, &
            0.286378,-0.562290,0.687525,0.402389,0.307821,0.288055,-0.598371,-0.246697, &
            0.163318,-0.411972,-0.143017,0.174221,-0.064809,0.391217,-0.374384,-0.066287, &
            0.058231,-0.345223,0.056176,0.451236,0.210226,0.201803,0.194940,0.458035, &
            0.046120,-0.094171,0.212243,0.208949,0.206988,0.583783,0.164375,-0.184193, &
            -0.003270,-0.299069,-0.058314,0.045048,0.121969,0.457148,-0.164417,-0.166764, &
            -0.027668,-0.050353,0.166359,-0.477037,-0.260786,-0.025660,-0.361493,0.051329, &
            -0.008350,-0.013040,0.003615,-0.559145,-0.241733,-0.137596,-0.539352,0.105449, &
            0.050350,-0.330099,0.019550,-0.663797,-0.187126,-0.037745,0.165521,0.146510, &
            0.004328,-0.097495,0.001312,-0.429314,0.086059,0.038981,0.230922,0.230121, &
            -0.010475,-0.037215,-0.136793,-0.480938,-0.029434,-0.019061,0.074079,0.605442, &
            0.011264,-0.080322,-0.347429,-0.133855,-0.116206,-0.057448,-0.125688,0.308651, &
            -0.000947,-0.027546,-0.267652,-0.188705,-0.058122,-0.066842,-0.223295,-0.055757, &
            -0.077269,0.173801,-0.106995,0.117024,0.232392,0.007250,-0.210479,-0.424497, &
            0.055965,-0.018854,0.628989,0.159097,0.088348,-0.092655,0.524743,-0.333676, &
            0.002958,-0.129272,0.509750,0.007537,-0.435597,0.004553,-0.069254,0.368165, &
            0.123397,-0.278195,0.075048,0.301472,0.021980,-0.208573,-0.226069,-1.016773, &
            0.020410,0.118093,-0.091356,0.571773,0.101408,0.054928,-0.528245,-0.358168, &
            -0.096750,0.125405,-0.171607,0.034006,0.010138,0.054628,1.309985,-0.010732, &
            -0.100199,-0.007149,-0.271070,-0.301105,0.093547,0.150133,-1.173617,-0.020996, &
            0.008155,0.193213,0.980401,0.106356,0.152208,0.029170,0.078839,0.163809, &
            0.048755,-0.279561,0.315844,-0.350464,-0.329695,-0.146710,0.969143,-0.200406, &
            -0.059326,-0.041942,-0.007035,-0.191982,-0.049847,0.107348,-0.980869,-0.271165, &
            -0.111572,0.211127,0.217901,0.378732,-0.100582,0.121764,0.187052,-0.174194 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-3.452676,-5.583849, &
            -1.402104,-0.294245, &
            0.451244,0.088861, &
            -0.376011,0.912174, &
            1.068157,-0.040788, &
            -2.510477,-5.171398, &
            0.155254,-2.244054, &
            0.641755,0.594066 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-1.172048,-1.855802/),(/1,2/))
real, dimension(8) :: bias1 = &
(/1.537319,1.138332,-0.8577,-0.832294,0.038419,1.264533,-0.507693,-1.817424/)
real, dimension(2) :: bias2 = &
(/-0.195044,0.545884/)
real, dimension(1) :: bias3 = &
(/1.661735/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
