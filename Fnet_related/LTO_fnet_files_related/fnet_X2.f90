module fnet_X2

! a = 0.015276
! b = -0.57708

intrinsic Reshape
real, dimension(8,54) :: input = &
  Reshape((/0.007151,2.175473,-1.164917,0.820049,-0.049544,0.052468,0.538855,-0.340116 &
			,-0.897678,3.416451,-0.153307,-0.328353,1.435399,-0.426636,-0.169972,-0.748167 &
			,-1.616119,3.192061,-0.089178,-0.937484,2.264533,-0.417612,-1.135253,-0.954577 &
			,-2.075513,2.657509,-1.002409,-1.110360,1.956856,-0.600131,-0.684125,-0.753233 &
			,-1.678430,1.756928,-1.859220,-1.247289,2.161904,-0.371336,-0.934353,-0.940293 &
			,-2.197218,1.080600,-2.287251,-1.486682,2.755325,-0.474257,-1.158980,-0.512949 &
			,-3.009126,0.493705,-2.778883,-1.710762,3.006444,-0.523266,-1.760169,-0.927129 &
			,-3.381369,0.712679,-2.834531,-2.450322,3.835899,-1.419725,-2.853361,-1.868357 &
			,-7.283482,-0.103383,-2.055692,-6.586966,4.849851,-4.912403,-7.028496,-5.047569 &
			,-5.414488,-0.905242,-5.326423,-5.129344,0.207710,-4.223409,-5.485413,-2.633518 &
			,-2.700210,1.287334,-4.709996,-3.608676,-1.657639,-3.904729,-3.436332,-1.737840 &
			,-1.326289,1.119804,-2.499954,-1.775345,-1.695542,-3.886207,-1.209827,-1.263880 &
			,-0.218959,0.078717,-0.867198,-1.097435,-0.697288,-2.920337,-0.407739,-0.456919 &
			,0.246606,0.364307,0.099351,-0.374043,-0.103101,-2.928286,0.415145,0.438009 &
			,-0.018796,0.060450,-0.043368,0.286605,0.147433,-3.346675,-0.081370,-0.547946 &
			,-0.015196,-0.180603,0.300876,0.596913,-0.071743,-3.648130,0.134134,-0.692447 &
			,0.294276,-0.132447,0.474236,0.057784,0.130954,-3.571325,-0.056480,-0.621000 &
			,0.347538,-0.176833,0.175587,-0.283710,-0.250336,-3.773868,-0.062867,-0.991590 &
			,-0.136750,-0.047098,-0.051161,0.208678,-0.012755,-0.500786,-0.003885,0.634541 &
			,0.009960,-0.116205,0.136500,0.176468,0.094271,-0.244544,0.042366,0.057669 &
			,-0.102759,0.193341,-0.190685,0.013878,-0.181173,-0.187519,0.030631,0.024726 &
			,-0.211979,0.018368,-0.114321,0.237458,-0.104637,-0.054205,-0.021672,-0.015020 &
			,-0.218870,-0.171382,0.021504,-0.041304,-0.217724,0.029669,0.173544,0.035662 &
			,-0.043061,-0.116723,0.090088,0.120823,-0.128076,-0.144523,0.013698,-0.101546 &
			,0.007625,0.355521,-0.219666,0.135904,-0.062144,-0.140312,-0.106163,-0.148563 &
			,0.028863,-0.107929,0.056168,0.061554,0.094918,-0.081128,-0.014415,-0.175118 &
			,-0.027380,-0.191673,-0.026131,0.043355,-0.000484,0.299162,-0.264834,-0.537876 &
			,0.071426,0.295181,-0.146374,0.045252,-0.191966,-0.056501,-0.033462,-0.968686 &
			,0.001460,-0.055891,0.060283,-0.105674,-0.258485,-0.052751,0.274837,-1.175052 &
			,0.052857,-0.075400,-0.065058,-0.378789,0.278099,0.042038,0.466695,-0.414086 &
			,0.089879,-0.085117,0.085164,-0.214858,0.166484,-0.466814,0.302822,0.674213 &
			,0.041996,0.045426,-0.067143,-0.097415,-0.020548,-0.205521,-0.116405,0.361325 &
			,-0.003877,-0.056387,0.011074,0.126007,0.354392,0.057979,0.117432,-0.075897 &
			,0.116959,-0.008233,0.008251,0.056716,0.025903,0.240812,-0.296784,-0.688055 &
			,-0.106406,0.065637,-0.139690,-0.009417,-0.104663,-0.090518,0.018350,0.139020 &
			,-0.064216,-0.059699,0.103574,-0.210026,-0.071760,0.023131,0.266966,0.417814 &
			,0.218956,-0.668302,0.245831,0.067078,-0.161602,-0.060606,-0.045428,0.003835 &
			,0.342918,-0.307710,0.279693,-0.173165,-0.102653,-0.187659,-0.273400,-0.044457 &
			,-0.140418,-0.168138,-0.112508,0.186894,0.000790,0.005705,-0.010922,0.085852 &
			,0.261317,0.022291,0.188856,-0.105718,-0.012294,0.174467,-0.093585,-0.262749 &
			,-0.178474,-0.080275,-0.020593,-0.067583,-0.145036,-0.033747,0.247162,0.242285 &
			,0.176100,-0.048689,-0.006933,-0.032235,0.136091,-0.016987,-0.277672,0.104864 &
			,0.286341,0.034551,0.409292,0.214169,0.107636,-0.197561,-0.037417,0.044661 &
			,0.333859,0.152970,0.169920,-0.048276,0.015385,-0.002325,-0.280162,-0.010121 &
			,0.570469,-0.802844,0.659841,0.225820,0.166453,0.457842,-0.088343,0.255122 &
			,0.555392,0.091823,0.985680,-0.231132,-0.104144,0.167393,-0.553444,-0.270068 &
			,0.510685,-0.218934,0.553430,0.211659,-0.211359,0.219531,-0.063344,-0.739972 &
			,0.217119,0.033400,0.832532,0.060034,-0.237953,-0.219211,-0.104013,-0.551315 &
			,0.098409,-0.466976,0.174404,0.146440,-0.015678,0.481478,-0.304020,-0.605649 &
			,0.085762,-0.579735,0.577726,0.039566,0.134431,0.208779,-0.530368,-0.731259 &
			,0.325077,-0.941674,0.364353,0.444770,0.224106,0.471339,0.060312,-0.508996 &
			,0.332122,0.047862,0.661593,-0.319919,0.301760,-0.037787,0.214826,-0.494213 &
			,0.605479,-0.687457,1.063516,-0.004001,0.292648,-0.227414,-0.097791,-0.024866 &
			,0.159121,-0.563575,0.732714,-0.137250,0.285360,-0.397278,0.134314,-0.023825 &
            /),(/8,54/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/0.529343,-2.573601 &
			,-0.056975,1.492407 &
			,-1.025750,0.932512 &
			,1.234077,-2.147941 &
			,-0.900202,0.476420 &
			,2.980194,-3.502505 &
			,1.548050,-2.105409 &
			,1.376939,-2.275030 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/1.481776,-0.954463/),(/1,2/))
real, dimension(8) :: bias1 = &
(/1.428018,-0.60922,0.460767,0.666315,-0.364753,1.661428,1.127819,0.965255/)
real, dimension(2) :: bias2 = &
(/0.242431,-0.395016/)
real, dimension(1) :: bias3 = &
(/0.457144/)
contains
subroutine fnet_X2_initall()
end subroutine fnet_X2_initall
subroutine fnet_X2_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(54) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 54
  !  inarray2(i) = inarray(55-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_X2_engine
end module fnet_X2
