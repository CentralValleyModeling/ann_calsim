module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
Reshape((/-0.405312,-0.221358,0.007327,0.022781,-0.927552,-0.076924,-0.005643,-0.105849, &
            -0.320404,-0.341836,0.091112,-0.010196,-1.359422,-0.027572,0.035753,0.391833, &
            -0.722624,-0.491797,0.109372,-0.050339,-1.308287,-0.030534,0.041466,0.560779, &
            -0.528934,-0.430864,0.274819,-0.019579,-1.567274,-0.024691,0.019929,0.616944, &
            -0.445832,-0.438045,0.261972,0.045471,-1.185406,-0.014025,0.012278,0.495976, &
            -0.451132,-0.451717,0.209023,0.098420,-1.127852,-0.038520,0.003400,0.260600, &
            0.027962,-0.408176,0.194207,0.060842,-1.307629,-0.067131,0.001783,-0.080707, &
            0.254568,-0.344115,0.086796,0.169894,-1.048272,-0.083022,0.001210,-0.424729, &
            -2.855264,-3.474254,0.509337,2.758808,-2.204511,-0.095412,0.021329,-1.781378, &
            -0.858481,-3.199572,-1.411438,3.281378,-0.229470,1.830599,-0.641033,-0.558025, &
            -1.316209,-0.707318,-1.700845,1.258595,4.100678,2.680047,-0.863225,0.754089, &
            3.617129,-0.653299,-0.668761,1.535923,-1.498108,2.000551,-0.643112,-0.720668, &
            -2.014256,0.110328,-0.093037,3.365016,-0.837837,0.720454,-0.291701,-1.918417, &
            -1.752148,-1.135548,0.990292,-0.013520,-3.665537,-0.642456,-0.285344,-0.429417, &
            3.470532,-0.124344,0.450736,0.360076,-0.357172,0.601277,-0.204186,-0.087931, &
            4.461834,-1.325445,-0.424141,0.024233,2.490530,0.771732,-0.531493,0.334055, &
            2.559464,-1.861865,1.097948,0.877805,-3.534773,-0.765589,0.106851,1.392632, &
            1.107326,-0.041352,-0.102261,1.846001,-0.930167,-0.024138,0.254058,-0.882760, &
            -1.371740,-0.133322,-0.005518,-0.063353,1.599339,0.007915,0.007526,0.922511, &
            -2.223905,0.132337,-0.206306,-0.843077,2.014671,0.456169,0.069124,0.880624, &
            -0.699021,0.056292,-0.461351,-0.532065,0.232808,0.337255,0.208286,0.527913, &
            -0.798592,0.012237,-0.663650,-0.004078,1.031865,0.462733,0.005516,-0.029071, &
            -0.947028,-0.169894,-0.398464,0.050869,2.463088,0.213060,0.102245,0.057217, &
            -0.493710,-0.373088,-0.266366,-0.233914,0.084018,0.009288,0.082237,-0.325020, &
            0.517961,-0.252762,0.522907,-0.160454,-1.577333,-0.085246,0.121582,-0.118957, &
            0.618485,-0.475536,0.751911,-0.163327,-2.787323,-0.095262,0.076212,-0.125651, &
            0.324506,-0.408565,0.476586,0.153525,-0.964296,0.459654,0.794119,0.847906, &
            0.032023,-0.636128,-0.249453,-0.245005,2.728067,0.341355,0.175954,-0.851629, &
            -3.313463,-0.274562,-0.556048,0.441378,1.560991,-0.021330,0.243452,-0.201565, &
            -1.321536,-0.282378,-0.414786,-0.724227,-0.241072,-0.114304,0.144643,-0.453378, &
            -1.945257,-0.372461,-0.289246,-0.220444,-1.094108,0.399457,-0.225798,0.366981, &
            0.164177,-0.001027,0.174574,0.385522,0.245676,-0.243510,0.108009,-0.398151, &
            -3.837758,-0.383422,-0.739348,-0.860848,5.181696,-0.403097,0.047129,-0.267177, &
            -0.492168,0.605799,-1.159459,0.143881,-3.585420,0.639729,0.083837,-0.142722, &
            -0.525591,0.167672,0.804501,0.152883,0.634531,-0.369468,0.183698,0.278813, &
            -4.153095,-0.296692,-1.765874,0.214386,2.198072,-0.233352,0.017529,-0.818095, &
            -1.347529,2.353546,-0.919417,2.447342,3.921931,-3.293283,-2.936874,3.835660, &
            -0.655686,3.078307,-1.855124,3.557023,3.613491,-3.798133,-3.371232,4.265883, &
            -1.370664,2.385635,-1.580310,4.776590,3.106401,-3.343300,-2.863943,3.834661, &
            -1.452879,1.909974,-1.486944,5.597117,3.276392,-3.329244,-2.541499,3.386437, &
            -1.447422,1.805343,-1.334029,5.535770,2.951394,-3.044559,-2.327678,2.997662, &
            -1.652076,1.762714,-1.600828,5.736566,2.517769,-3.360812,-2.545547,3.195357, &
            -1.205774,2.237827,-2.060442,5.859504,2.159060,-3.671660,-3.011552,3.402937, &
            -0.907557,2.517421,-2.434153,5.775757,2.095031,-3.785585,-3.757312,3.977225, &
            3.022071,8.105389,-6.442051,7.267771,-0.224016,-8.005830,-8.767381,8.457844, &
            2.893660,6.535217,-4.534914,6.412319,-0.061822,-6.930311,-5.629512,7.322853, &
            2.257920,4.155462,-2.806842,6.115497,0.658797,-4.977191,-2.097395,5.499336, &
            1.446026,2.875618,-2.042023,5.265271,1.216104,-3.419210,-0.178882,4.386637, &
            0.790691,1.578795,-1.214782,2.099516,0.834360,-2.868739,1.097430,3.142552, &
            1.775388,0.596136,-0.837347,2.362831,0.766685,-2.562807,0.762445,2.857860, &
            0.025026,0.203650,0.265513,0.343122,1.950625,-1.885826,0.314338,1.446729, &
            -0.607507,-0.134293,0.251051,-0.663721,0.893653,-0.442069,0.131279,1.282255, &
            -1.204537,-0.133240,0.808371,-0.310480,2.477806,-0.189161,-0.227207,0.169799, &
            -0.402790,-1.494268,0.101287,-0.029982,2.798275,-0.200528,-0.354631,-0.150299, &
            1.172955,0.377028,-0.234971,-0.177067,2.442256,-0.765383,0.125034,-0.217498, &
            1.335095,0.675321,-0.266699,-0.131312,2.143164,-0.530784,-0.055761,-0.290335, &
            1.872521,0.510244,-0.454062,0.078548,1.821188,-0.991441,-0.085787,-0.241509, &
            2.082397,0.944939,-0.604179,0.003365,1.125672,-1.231271,-0.316098,0.060385, &
            2.207983,1.216501,-0.770961,0.014647,1.015168,-1.308250,-0.617663,0.138795, &
            2.407129,0.966217,-0.955101,0.251814,0.526148,-1.353001,-0.794584,0.237992, &
            2.529448,1.096162,-1.109944,0.280106,0.376930,-1.358735,-1.075946,0.279364, &
            2.613195,1.025929,-0.935167,0.041719,0.149250,-1.537611,-1.049425,0.147495, &
            1.751451,0.772326,0.019239,-0.120066,0.340826,-0.821766,-1.394725,-0.301702, &
            2.235749,1.092881,-0.297956,0.102469,-0.532847,-0.717165,-0.900672,0.512621, &
            2.242471,1.822008,0.198395,1.118862,-0.113970,-1.705920,-0.943085,1.585556, &
            2.998101,0.347606,0.596781,1.105773,1.070251,-0.924064,0.131798,1.191456, &
            1.895126,0.078891,0.826310,-0.454518,0.564851,-0.756676,-0.109061,1.218403, &
            1.037114,0.005909,0.912391,1.048808,-0.650304,0.677328,0.393698,0.319715, &
            1.245337,0.328178,-0.190543,2.834183,-0.166278,0.249254,-0.140398,0.488724, &
            2.997859,-0.742336,-1.083123,0.262419,-1.709218,-0.656755,-0.619892,0.449948, &
            1.551118,-0.275052,-0.101056,0.788524,0.007916,-0.058364,0.058849,-0.920032, &
            0.532199,0.294360,-0.087012,-0.314729,-0.168410,-0.678820,0.608614,0.220783, &
            -0.939406,-0.505778,0.148462,-0.615150,-1.520667,-0.329776,0.469758,0.547134, &
            -0.174691,-0.329900,0.362508,-0.359284,-1.189880,-0.122831,-0.002909,0.320491, &
            -0.012267,-0.160696,0.227701,0.251287,-1.179037,-0.065897,0.047305,0.454287, &
            0.822418,-0.038866,0.170530,-0.006478,-0.413864,0.023727,-0.022100,0.101210, &
            0.765331,0.023489,-0.102465,-0.228105,0.119667,-0.001988,0.029091,-0.016099, &
            -0.311966,-0.134173,-0.029877,-0.192437,0.894942,-0.200591,0.022790,0.118274, &
            -0.670638,0.150484,-0.206939,-0.320324,-0.751574,0.083355,0.001290,0.170856, &
            -0.443145,-0.210804,0.132746,-0.248692,0.457383,-0.548701,0.054462,0.194623, &
            -0.687085,-0.451616,0.209951,-1.593254,5.069326,-0.420394,-0.000022,0.195267, &
            -0.290616,1.181921,0.111315,0.740712,-0.917288,-1.572434,0.165029,0.734262, &
            -1.519216,-0.360817,0.338914,1.482084,2.568090,0.100526,0.632025,-0.151656, &
            -1.930616,0.015867,-0.905577,2.628712,4.792846,0.079470,0.389927,0.500137, &
            -0.272571,0.138858,-0.341039,-0.103204,-2.061961,0.006765,0.702239,-0.062416, &
            0.480758,0.767864,-0.640530,0.058457,-1.691413,-0.599763,0.344698,-0.698634, &
            -1.000192,-0.901276,0.045731,-1.610707,0.424792,0.650824,-0.014780,-0.587395, &
            0.477578,0.271403,-0.323879,-0.480674,0.782233,0.341474,-0.649624,0.448669, &
            1.503816,0.027450,0.347106,-1.210212,-1.727045,-0.005146,-0.553678,-0.214991, &
            1.207786,-0.412208,0.606809,1.585461,-2.114686,0.375169,-0.839663,-0.385106, &
            0.414874,0.237627,0.092048,-0.423655,-0.771469,-0.051583,-0.052961,-0.355993, &
            0.078355,0.148654,0.016744,-0.173703,-0.931391,0.210606,0.201950,-0.201933, &
            -0.618202,0.537915,-0.143628,-0.577509,-0.413284,-0.068375,0.351076,-0.139283, &
            -0.722117,0.400827,-0.039314,-0.425403,-0.758100,0.124353,0.178504,0.130796, &
            -0.606409,0.441271,-0.163919,-0.249254,-1.003410,0.238530,0.227666,0.118549, &
            -0.245861,0.193813,0.027758,-0.378811,-0.546210,0.298179,0.075153,0.187064, &
            -0.511976,0.466214,-0.157665,0.093589,0.152834,0.493634,0.002962,0.155698, &
            -0.873587,0.371883,0.240474,-0.046972,0.961658,0.228116,0.107231,0.116904, &
            -0.232756,-0.353114,-0.273544,-1.563607,1.233704,0.298610,0.694997,-0.580253, &
            0.047662,-0.176854,0.383943,-1.647820,0.430326,-0.068916,-0.005835,-0.355235, &
            1.402867,-0.571947,-0.724329,-0.967677,-0.505519,0.344385,-0.224953,-0.507714, &
            -0.884646,0.119586,-0.215557,0.227196,-1.167266,0.518233,-0.196762,-0.897744, &
            0.792849,-0.138184,-0.969525,-2.127314,-0.239842,0.323458,-0.258725,-1.080717, &
            1.928957,0.039924,-0.462268,-2.296478,0.569638,-0.075417,-0.248475,-0.686126, &
            0.386323,0.224664,-0.198091,-1.017485,-1.991904,0.359952,0.105474,-0.846727, &
            0.319753,0.672979,0.286936,1.929400,-0.528093,0.481165,-0.634729,-0.576552, &
            1.035547,-0.403466,0.799321,-0.836247,-0.428379,0.330334,-0.133964,-0.650481, &
            1.920871,-0.268022,0.011473,-1.523812,-2.292597,-0.095678,-0.068745,-0.447968, &
            0.566036,-0.023417,0.086710,0.160657,-0.282616,0.058531,0.038990,0.118017, &
            0.673473,-0.047374,0.005598,0.161671,3.006345,-0.045519,0.033396,0.061030, &
            0.310802,0.262669,0.134629,0.261880,3.261746,0.049109,0.033761,-0.190554, &
            0.173336,0.046256,-0.102452,-0.197873,2.702762,0.120965,-0.081717,-0.124689, &
            -0.468057,0.106438,-0.055918,-0.302816,0.461236,-0.030591,-0.002071,0.003496, &
            -0.364399,0.131225,-0.197357,-0.027869,0.707213,-0.001037,0.033400,-0.212142, &
            -1.055867,-0.072416,-0.379209,0.235024,0.917900,-0.041728,0.031379,-0.046237, &
            -0.884067,0.250592,-0.314061,-0.179537,1.237981,0.064063,0.074607,0.191143, &
            -0.173082,-0.084796,0.001254,-0.055875,1.048675,0.011934,-0.097291,0.363441, &
            0.064312,0.119658,-0.088969,-0.040670,-1.424798,0.216729,-0.054320,0.192486, &
            0.085375,0.000506,0.309266,0.010785,0.045400,-0.109564,0.056913,0.196604, &
            -0.923487,-0.290704,-0.074245,-0.128902,1.237986,-0.126796,0.039035,0.675133, &
            0.955187,0.242117,0.052270,0.029676,-0.962841,0.158461,-0.148156,-0.724615, &
            -1.061867,-0.162767,-0.279134,0.353221,1.093133,-0.007041,-0.002832,0.001424, &
            0.528052,0.031271,0.211605,0.006660,-0.430885,0.025005,-0.008771,0.168313, &
            -0.541412,0.150878,-0.223100,-0.485457,1.034287,0.046812,0.135624,0.421344, &
            1.326298,0.027002,0.232667,0.477643,-0.599185,0.035914,-0.088055,-0.579236, &
            0.717773,-0.069361,0.494583,-0.274799,-0.810146,-0.115452,-0.025199,0.406115 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
Reshape((/0.340385,0.559293, &
            -0.560859,2.414720, &
            2.072678,-6.338339, &
            3.815948,2.326592, &
            0.170780,-0.750049, &
            -0.198889,-6.934868, &
            0.359196,-5.917890, &
            2.170437,2.128207 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
Reshape((/1.527506,-1.784342/),(/1,2/))
real, dimension(8) :: bias1 = &
(/-1.405237,-2.456538,2.778549,-1.626316,3.088954,2.579074,2.770146,-2.915407/)
real, dimension(2) :: bias2 = &
(/-0.177601,-0.461326/)
real, dimension(1) :: bias3 = &
(/0.380594/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
