module fnet_MTZ

! a = 2.9315e-005
! b = 0.086358

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/-0.160611,0.177612,0.172278,-0.076809,0.199932,0.106870,-0.116672,0.064992, &
            0.073551,-0.155672,0.052074,0.081123,-0.047954,-0.042749,0.047056,0.013914, &
            -0.117034,0.125463,0.021447,-0.078144,0.076426,0.231937,-0.057716,0.110433, &
            0.112727,-0.111607,-0.003019,-0.157567,0.020363,0.040047,0.006989,-0.166623, &
            -0.011386,0.027935,-0.062270,-0.071935,-0.064721,0.108653,0.104629,0.078304, &
            -0.115206,0.046291,-0.051557,-0.265557,-0.011458,0.063114,0.025067,0.028940, &
            -0.147787,0.118084,-0.013799,-0.385519,0.106541,-0.017573,0.195843,0.089434, &
            -0.160044,-0.082603,0.130804,-0.316319,0.140725,-0.033172,0.056894,0.075720, &
            0.170389,0.053502,-0.014469,0.446667,-0.270507,-0.035947,-0.064501,-0.182618, &
            0.210796,0.358606,-0.245936,0.088915,0.036491,0.059180,-0.043488,-0.189811, &
            0.332417,0.345587,-0.421564,-0.333052,-0.101520,0.513099,0.058688,-0.332215, &
            0.007484,0.179182,0.005133,0.076451,0.018446,0.674544,-0.272406,0.104417, &
            -0.112518,0.034190,0.147340,-0.011851,-0.083197,0.330655,0.069045,0.212668, &
            -0.086748,-0.118653,-0.343580,0.065316,0.103841,0.441461,-0.354835,0.641639, &
            0.010781,-0.410189,-0.021138,0.371965,-0.107759,-0.022573,-0.018810,0.544621, &
            0.226532,-0.328214,0.074006,0.505171,-0.174149,0.026263,-0.003061,0.093101, &
            0.447670,-0.236818,-0.098421,0.346689,-0.181021,-0.174423,-0.058517,-0.270329, &
            0.289219,-0.454615,0.088070,1.028126,-0.207153,-0.666129,-0.083420,0.158750, &
            -0.106296,-0.202701,0.017412,-0.195094,-0.012838,-0.097273,-0.316580,0.015374, &
            -0.103767,0.002208,0.087107,-0.183700,-0.072271,-0.257619,-0.153165,-0.125096, &
            0.014637,-0.209878,0.205997,-0.102030,-0.080139,-0.196944,-0.088544,0.007859, &
            -0.001942,0.121910,0.133601,0.207253,-0.249884,0.000443,-0.142587,-0.073950, &
            0.038089,-0.001565,-0.028802,-0.141835,-0.228947,-0.192292,0.020621,-0.061188, &
            0.001802,0.142550,0.036901,0.000277,-0.019274,-0.271475,-0.037635,-0.070260, &
            0.207783,-0.048257,-0.014495,0.085650,-0.091830,-0.140408,-0.173896,-0.186195, &
            0.183305,0.013037,-0.034831,0.044124,-0.230193,0.091779,-0.379146,-0.142724, &
            0.264947,0.068991,0.295997,-0.050684,-0.153977,-0.414631,-0.572305,0.439051, &
            -0.103654,0.175134,0.384439,-0.058397,0.015041,0.080539,-0.298681,0.399163, &
            -0.105941,0.151565,0.025150,-0.517323,0.248020,0.256654,-0.196667,0.465301, &
            0.100286,0.122374,-0.408882,-0.257835,0.163670,0.213737,-0.670762,-0.257524, &
            0.041264,0.260367,-0.261984,-0.487490,0.201245,0.060357,-0.334631,-0.383860, &
            -0.052359,0.159850,-0.170293,-0.381349,-0.139154,0.439830,0.137141,0.088692, &
            0.016147,0.232344,-0.051865,-0.017810,0.252964,0.123201,0.198974,0.128998, &
            -0.302369,0.042165,0.096157,-0.155689,0.030907,0.254874,0.037366,0.341152, &
            0.113516,-0.192608,0.014079,-0.098747,-0.126696,-0.093954,0.133419,0.007938, &
            -0.062354,0.072563,-0.096659,0.054732,0.014255,-0.233216,0.208996,0.165317, &
            1.077113,-0.001456,-3.223806,0.399735,4.104054,1.106425,0.408735,-0.236335, &
            0.383439,-0.155631,-2.754458,0.368062,3.528926,0.978308,0.383814,-0.364688, &
            0.189893,-0.544343,-2.713460,0.813933,3.167108,1.498336,0.582409,-0.369948, &
            0.132743,-0.694204,-2.026848,0.915285,2.465390,1.229178,0.475735,-0.260030, &
            0.193823,-0.915029,-1.056324,0.811370,2.063354,1.391054,0.573363,-0.341117, &
            0.073477,-0.942575,-0.799710,1.151345,1.395673,1.475136,0.339405,-0.349335, &
            -0.646484,-1.656098,-0.357936,1.566189,1.125930,1.562843,0.565122,-0.525595, &
            -1.491842,-2.207689,-0.370078,1.988604,1.722273,2.337382,1.492441,-1.459511, &
            -6.436299,-5.498842,-0.507266,4.747158,3.070453,5.538196,5.079102,-4.970120, &
            -7.168736,-3.727192,1.460676,2.089419,-0.286205,2.233467,2.891732,-3.924127, &
            -5.227323,-1.386837,0.711733,-0.556271,-0.292403,-0.171197,0.391845,-1.827377, &
            -2.879080,-0.242563,-0.247245,-1.776671,-0.020031,-0.895212,-0.521567,-1.025361, &
            -1.922321,0.506445,0.381081,-1.273978,0.559011,-0.705129,0.154125,-1.900279, &
            -1.304603,0.839181,0.442883,-0.900652,0.485247,-0.491991,0.649243,-1.510816, &
            -0.310296,0.380022,0.198188,-0.742133,0.178883,-0.167689,0.545855,-0.989056, &
            0.222101,0.341585,-0.012392,-0.312962,0.402762,0.037024,0.267920,-0.424094, &
            0.417760,-0.089043,-0.260303,0.043539,-0.336153,0.250196,-0.268906,-0.281711, &
            -0.351448,-0.260869,-0.008078,0.125384,-0.276225,0.327173,-0.698308,0.180662, &
            -0.159201,-0.001032,-0.780823,0.479225,0.710178,0.192882,0.388304,0.023194, &
            -0.037407,-0.046756,-0.501476,0.155439,0.640253,0.384031,0.161262,0.228058, &
            -0.154337,0.254800,-0.713625,0.466077,0.525977,0.185054,0.174493,-0.004671, &
            -0.124703,0.078789,-0.486550,0.513136,0.409409,0.244553,-0.056090,-0.051518, &
            -0.057725,0.049604,-0.352332,0.500911,0.206865,0.056834,0.267881,-0.093590, &
            -0.179107,-0.257978,-0.256363,0.309865,0.311412,0.411584,0.310868,0.120769, &
            -0.188426,-0.522680,-0.338975,0.549085,0.085061,0.365419,0.070266,-0.171700, &
            -0.333506,-0.764305,-0.439871,0.446441,0.243121,0.523322,0.403629,-0.039196, &
            -1.288034,-1.064147,-0.437406,0.840061,0.170961,1.107880,1.158582,-0.892072, &
            -1.699887,0.080512,-0.030240,0.715781,-0.068649,0.372375,0.780678,-1.284346, &
            -1.492458,0.883412,-0.184327,0.331670,0.208148,-0.240934,0.836017,-1.060655, &
            -1.017749,0.527054,-0.044657,0.168692,0.009702,-0.233593,0.147748,-0.841749, &
            -0.606120,-0.121418,0.470084,0.095109,-0.292611,0.403475,-0.080060,-0.046045, &
            0.036736,-0.373480,-0.208128,-0.407661,0.145940,0.219533,-0.704829,0.752978, &
            0.200174,-0.355472,-0.012589,0.034469,0.158515,0.127599,-0.152754,0.544148, &
            -0.182149,-0.382427,0.609193,-0.351631,0.032375,0.054664,0.234471,0.087909, &
            -0.335327,-0.162992,0.436331,-0.114948,0.377020,-0.366587,0.231147,-0.021481, &
            -0.340909,0.450586,0.479876,-0.857864,0.669457,-0.401884,0.232759,0.067887, &
            0.245603,-0.412359,0.211992,0.116679,-0.872416,-0.447373,-0.191594,-0.269026, &
            0.131443,-0.183093,-0.017588,0.088865,-0.326828,-0.274245,0.159888,-0.090212, &
            0.070142,-0.000089,0.113202,0.144702,-0.161798,-0.224148,0.036935,-0.111947, &
            0.045987,-0.059851,-0.040973,0.094240,-0.076009,-0.125003,-0.027778,-0.082931, &
            -0.169765,0.139204,-0.038437,-0.016077,0.156676,0.231130,0.085935,0.288655, &
            -0.114080,0.063251,-0.059660,0.008617,0.071782,-0.007973,0.013243,-0.085807, &
            0.106784,-0.118068,-0.135731,0.118707,0.198916,-0.071830,0.020056,0.086837, &
            0.212531,-0.047111,0.043961,0.312946,0.304439,-0.205426,0.166586,-0.326758, &
            0.122232,-0.366749,0.135349,0.429564,-0.545392,-0.094505,0.392844,-0.614334, &
            -0.102821,-0.073625,-0.107987,0.713639,-0.193834,-0.233084,0.123155,-0.650500, &
            -0.160400,0.378867,0.188219,-0.126585,-0.576067,-0.515899,-0.451753,-0.196637, &
            -0.090937,0.224953,0.426041,-0.253139,-0.244737,-0.647610,-0.038187,-0.219901, &
            -0.448104,0.370134,0.572816,-0.442551,-0.555482,-0.800658,-0.000919,-0.313191, &
            -0.126689,0.078682,-0.094912,0.037865,-0.095366,-0.697014,-0.247291,-0.059569, &
            -0.313040,0.025686,-0.489509,-0.159687,-0.338198,-0.508990,-0.523117,0.234036, &
            -0.405348,0.024301,-0.492423,0.053862,0.445707,-0.184830,-0.094510,0.380915, &
            -0.106819,-0.013931,-0.182478,-0.019245,0.382555,0.065916,0.089420,-0.008933, &
            0.151655,-0.278666,0.029097,-0.124092,0.158077,0.224802,0.231659,0.236127, &
            -0.116659,-0.064459,0.188361,0.112483,-0.005443,0.130634,-0.175451,0.211625, &
            -0.148731,-0.120599,0.367923,-0.011320,-0.019635,-0.162954,0.057195,0.110354, &
            0.013214,-0.027043,0.059241,-0.236331,0.114100,-0.154153,0.157471,-0.014251, &
            0.031588,-0.177075,0.166979,-0.135090,0.044933,-0.000407,0.034492,0.040124, &
            -0.105490,-0.060213,0.173478,-0.075613,-0.082157,0.171508,-0.117469,0.051703, &
            0.164418,0.118939,-0.048690,-0.144284,0.157594,0.034996,0.050580,-0.145515, &
            -0.014590,0.151303,-0.039617,-0.031986,0.017395,-0.044826,-0.014769,-0.023806, &
            0.084020,0.071353,-0.025534,-0.281878,0.023138,0.055336,0.118008,-0.136239, &
            0.396138,0.098269,-0.263672,-0.585307,-0.999809,-0.430403,-0.104864,-0.195560, &
            0.442543,0.293229,-0.865123,-0.565845,-0.724508,-0.159717,0.155902,-0.318752, &
            0.650064,-0.118963,-0.893563,-0.346580,-0.797011,-0.270745,0.134785,-0.264504, &
            0.214476,0.006161,-0.370185,-0.243115,-0.069424,-0.164190,0.471275,0.261939, &
            -0.112369,0.212392,-0.085612,0.088566,-0.073080,-0.286359,0.544221,0.399351, &
            -0.093338,0.119901,-0.245316,-0.188670,-0.326864,-0.141754,0.565279,0.432529, &
            -0.009950,-0.194087,0.099685,0.119808,0.320158,0.010382,0.312576,0.367118, &
            0.214298,-0.147378,-0.070814,0.151887,-0.005593,-0.167095,0.154884,0.064553, &
            0.186503,-0.414724,-0.175109,0.269188,-0.364832,0.095557,-0.398725,-0.036842, &
            0.461476,-0.583412,-0.102087,0.204761,-0.445599,0.070390,-0.035828,0.210320, &
            -0.103243,0.012394,0.122456,-0.064939,0.079609,0.102916,0.005162,0.085299, &
            0.048676,0.007539,-0.026266,0.031918,-0.024638,0.068148,-0.003699,-0.022173, &
            0.009359,0.053718,-0.082001,-0.027423,-0.015843,-0.158714,0.072953,-0.046356, &
            -0.020230,-0.053443,0.042820,-0.007489,0.032277,0.023883,-0.077670,0.005688, &
            -0.003268,-0.053618,0.006259,0.102551,-0.015333,-0.122783,0.023351,0.064128, &
            -0.085369,0.021723,-0.005699,-0.125625,0.015981,-0.099660,0.071145,0.050525, &
            0.034501,0.058913,0.033158,0.119204,0.006640,0.009770,0.095809,0.053513, &
            -0.001020,-0.047958,0.006021,0.111793,-0.002834,-0.132074,-0.030611,0.007137, &
            0.044184,-0.053086,-0.105958,-0.068255,-0.049154,-0.132385,-0.002921,-0.081900, &
            -0.035935,-0.044220,0.015130,0.015585,0.048956,-0.171048,-0.122995,-0.091096, &
            0.073673,0.024484,-0.081277,0.026845,-0.089127,0.145099,-0.018895,-0.039607, &
            0.062133,-0.041293,0.013133,-0.017425,0.023292,0.156304,-0.101723,-0.079007, &
            0.017307,0.100948,0.028616,0.007370,0.016410,0.351230,-0.003046,0.027507, &
            -0.020707,0.041040,-0.043619,-0.056338,0.000890,0.012390,0.009865,0.027306, &
            0.115222,0.051821,-0.041147,0.020096,-0.079194,0.197361,0.100485,0.012313, &
            -0.109328,0.058139,0.001957,-0.126832,0.070390,0.117986,0.030964,0.115431, &
            0.005179,-0.042601,-0.039651,0.089358,-0.055925,-0.027188,-0.071536,0.033769, &
            -0.028301,0.115028,0.062102,-0.055899,0.015122,0.536312,-0.004190,0.112592 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/1.631326,3.746603, &
            -0.446268,2.185814, &
            -4.640472,0.993746, &
            -0.045516,-1.335395, &
            1.542578,-2.244314, &
            -0.518681,-1.085774, &
            1.161040,-1.642371, &
            0.637818,2.379715 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-0.449954,1.071168/),(/1,2/))
real, dimension(8) :: bias1 = &
(/1.05939,0.947363,1.562126,-1.007339,-1.93776,-1.139572,-0.593474,0.67306/)
real, dimension(2) :: bias2 = &
(/-0.184654,0.438177/)
real, dimension(1) :: bias3 = &
(/0.490006/)
contains
subroutine fnet_MTZ_initall()
end subroutine fnet_MTZ_initall
subroutine fnet_MTZ_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_MTZ_engine
end module fnet_MTZ
