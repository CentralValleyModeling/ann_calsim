module fnet_MTZ

! a = 2.9315e-005
! b = 0.086358

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/-0.029677,-0.005340,-0.118341,0.051409,0.852840,0.012324,-0.069414,-0.074006, &
            0.073243,-0.043989,-0.030983,-0.039463,0.327559,-0.078886,0.014012,-0.038123, &
            -0.014776,0.014893,-0.018994,0.078707,0.509535,-0.008229,-0.036482,-0.004285, &
            -0.070198,-0.089559,0.006980,-0.120649,0.740994,0.033896,0.073757,-0.013323, &
            0.041075,0.121698,-0.040526,0.063955,1.040149,0.047273,0.019529,-0.083987, &
            -0.036352,0.002935,-0.029927,-0.032024,0.298084,0.055368,-0.031340,-0.066119, &
            0.069071,0.137618,-0.076984,0.019207,0.103525,0.021596,-0.057358,-0.223768, &
            -0.026794,-0.034638,-0.013309,-0.016139,0.125223,0.033701,0.000845,0.042114, &
            0.129640,0.304327,-0.207848,-0.220211,-0.041632,0.151165,0.135521,-0.521787, &
            0.277178,0.131414,0.053389,-0.169635,-0.051342,-0.277276,0.053448,-0.305164, &
            -0.030408,-0.145729,0.071138,0.156589,1.052412,-0.426018,0.088317,-0.019292, &
            -0.366296,-0.243350,0.094506,-0.067628,-0.005209,-0.033603,-0.103718,0.082628, &
            -0.514540,-0.057626,0.287850,0.077174,0.004098,0.065319,-0.018483,0.131231, &
            -0.299857,0.004589,0.060103,-0.059694,1.262544,0.357917,0.008138,-0.023952, &
            0.126491,-0.126427,0.065137,-0.112399,-0.059134,-0.162636,0.105847,0.075281, &
            0.339236,-0.077428,-0.001910,-0.209492,-0.330823,-0.280976,0.135256,-0.068297, &
            0.284208,-0.238394,0.101157,-0.387978,-0.182869,-0.220431,-0.006958,0.060402, &
            0.188130,-0.745710,-0.007754,-0.761561,-1.201275,-0.371252,-0.124240,-0.043420, &
            -0.183917,0.219679,-0.047927,-0.174984,-0.841752,0.360526,0.597324,0.118401, &
            -0.027340,0.375509,-0.165325,-0.092177,-0.658862,0.159753,0.450518,-0.048004, &
            -0.073627,0.145490,-0.075788,-0.101145,-0.433834,0.100306,0.179427,0.111849, &
            -0.044193,-0.010499,-0.138407,-0.069414,-0.345461,-0.124702,0.145625,0.079229, &
            0.119600,0.177679,-0.177858,-0.268783,-0.327716,0.043870,0.098293,-0.130396, &
            -0.006198,0.011174,-0.046724,0.039718,-0.340427,-0.201720,-0.099369,0.090718, &
            -0.001225,0.013893,-0.128669,-0.306339,-0.097407,0.048161,0.058960,-0.075619, &
            -0.065209,0.086134,0.024122,-0.138383,0.249177,-0.217521,0.215830,0.057667, &
            -0.250083,0.282512,-0.261895,-0.276924,1.416734,-0.413463,0.148521,0.323789, &
            -0.114402,-0.074718,-0.511868,-0.094984,0.920829,-0.254224,-0.239836,-0.158627, &
            -0.348885,0.437095,-0.191707,0.335572,0.628277,-0.293187,0.016022,-0.400334, &
            -0.241031,0.007483,-0.062803,-0.071327,-0.755217,-0.027926,0.446008,-0.020546, &
            -0.146327,-0.075504,0.149192,-0.107360,0.216357,0.068354,0.308615,0.107780, &
            -0.233580,-0.051463,-0.007018,-0.109557,0.624767,-0.001516,0.208767,-0.239052, &
            -0.353354,-0.110850,-0.007432,-0.031700,-0.051442,0.216417,0.149786,-0.076989, &
            -0.202093,-0.015670,-0.143539,0.197826,0.078672,0.188860,-0.135642,-0.031543, &
            -0.013346,0.098845,0.137600,0.171763,1.607598,-0.177518,-0.097346,0.082873, &
            0.163266,-0.019252,0.081227,0.042676,-0.508787,-0.339581,0.100013,0.182044, &
            0.425465,-0.150269,2.977663,0.643238,4.172763,0.026123,0.843414,-1.959842, &
            0.823641,-0.974192,3.137547,1.099758,3.638196,0.398633,0.899732,-1.686680, &
            0.732381,-0.947395,2.822837,1.362864,3.087832,0.666720,1.000232,-1.125173, &
            0.798342,-1.145083,2.499527,0.838372,3.175292,0.905922,1.095770,-0.777214, &
            0.819521,-0.678904,2.329300,0.975077,2.535215,0.577669,1.101188,-0.145336, &
            0.479382,-0.851934,1.920998,0.959373,2.320990,0.792303,1.380060,0.319811, &
            1.018258,-1.414164,1.763745,1.071818,1.533801,0.950697,1.374956,0.492593, &
            1.534122,-2.172520,2.248767,1.815089,0.928157,1.674384,1.999626,0.112263, &
            4.332808,-5.273894,2.637380,5.430257,-2.671760,5.852970,4.420118,-1.258563, &
            2.526535,-3.146769,-0.439726,3.507263,-3.150545,5.550954,2.637216,-0.045312, &
            0.799313,-0.432676,-0.880119,1.583662,0.105990,3.704109,0.554788,-0.174885, &
            0.098454,0.693597,-0.148837,0.113694,2.485582,2.169940,0.139942,-0.048163, &
            0.404499,0.413667,0.014153,-0.315243,2.989860,1.925657,-0.152043,0.151178, &
            0.639896,-0.057867,0.055851,-0.633737,2.688960,0.973425,-0.749294,-0.395606, &
            0.352025,-0.138931,-0.115169,-0.619989,1.778472,0.472668,-0.133725,0.119139, &
            0.130836,-0.007404,0.244193,-0.361750,2.044962,0.169865,0.458475,0.169618, &
            -0.393048,0.068878,0.348091,-0.108384,2.721912,0.003687,0.251269,0.116010, &
            -0.542685,0.072711,0.035791,0.051458,2.225230,0.435735,0.810069,0.221570, &
            -0.044649,-0.149752,0.927751,0.095232,0.408537,0.257542,0.670875,-0.577650, &
            0.075528,-0.256330,0.845814,-0.075456,0.780850,0.356058,0.409198,-0.318280, &
            0.153881,-0.470213,0.563303,-0.056670,0.335387,0.519099,0.706556,-0.022158, &
            0.035476,-0.437945,0.483161,-0.111924,0.498326,0.443215,0.604509,0.046840, &
            0.264445,-0.309740,0.704499,0.180120,0.387587,0.336036,0.745278,-0.106402, &
            0.045305,-0.493100,0.296696,0.025544,0.349242,0.399732,0.519798,0.002016, &
            0.138729,-0.387791,0.579526,0.040984,0.412791,0.698806,0.733540,0.070785, &
            0.464189,-0.617804,0.746652,0.401623,0.025502,0.513769,0.915506,0.320394, &
            0.849714,-1.169340,0.708992,0.736262,-0.019760,1.067078,0.844479,0.061719, &
            0.486584,-0.631210,0.165619,0.217151,0.579967,1.047506,0.610989,0.132193, &
            0.050474,-0.369821,-0.083997,-0.206394,1.359446,0.614147,0.352399,-0.338587, &
            0.104742,-0.174274,0.043185,-0.437259,1.350855,0.622092,0.255414,-0.124711, &
            -0.228191,-0.226026,0.008403,0.096295,1.535185,0.298285,0.528343,0.388820, &
            0.103199,0.431267,0.276352,0.086988,1.433330,-0.212738,0.112198,0.473197, &
            0.292802,0.161649,0.331456,0.242836,0.772388,-0.170740,-0.045516,-0.047628, &
            0.381523,0.311033,-0.172313,0.111840,-0.023266,-0.137888,0.332855,-0.125066, &
            0.389151,0.311410,-0.415286,0.255085,-0.711440,-0.033702,0.262888,-0.364376, &
            0.302497,0.444746,-0.298014,0.197200,-0.230893,0.426767,0.089279,0.008075, &
            0.394015,-0.016928,-0.300195,-0.289793,-1.002767,-0.206480,0.346201,0.278975, &
            0.449250,-0.047123,-0.159349,-0.146091,-0.646206,-0.135232,0.105850,0.301155, &
            0.002371,0.056343,-0.184413,0.066950,-0.112311,-0.012309,0.225174,0.121654, &
            -0.123875,-0.001269,0.008419,-0.047032,-0.214756,-0.017268,0.108721,-0.051567, &
            0.069626,0.160374,-0.064353,0.032360,0.019281,0.035591,-0.046899,-0.194488, &
            0.061658,0.100400,0.118637,0.096431,-0.072815,0.122898,-0.214955,0.118981, &
            0.290106,0.052674,0.076552,-0.032577,0.194562,-0.152716,-0.181126,0.002566, &
            0.259449,-0.299050,0.217672,-0.051819,0.281439,-0.248199,0.178104,-0.040417, &
            0.687524,0.041350,-0.685783,-0.063244,-0.418807,-0.234250,0.183941,0.580394, &
            0.408851,-0.303585,-0.555157,-0.164239,-1.587907,-0.075519,0.487832,-0.206272, &
            0.098396,0.000526,-0.590609,-0.007107,-1.948794,-0.243129,0.080579,-0.177141, &
            0.446634,-0.007393,-0.137558,0.242603,-1.477011,-0.203614,-0.057748,0.024015, &
            0.004032,0.205154,-0.520602,0.290675,-1.213256,0.134181,-0.170499,0.118028, &
            -0.138060,0.091095,-0.666400,-0.175824,-2.534520,-0.459986,0.427332,0.019756, &
            -0.887355,0.192113,-0.554398,-0.017411,-3.240283,-0.336403,-0.090955,-0.367151, &
            -0.523006,-0.174694,0.446146,-0.073108,-1.964613,-0.097937,-0.587448,-1.131519, &
            -0.041827,0.039138,0.471326,0.355241,1.165248,0.131617,-0.861363,-0.504298, &
            -0.039879,0.259481,0.339309,0.062065,1.481657,0.260116,-0.220885,0.004677, &
            -0.059415,-0.240820,-0.287587,0.011118,-0.346138,-0.094312,-0.086840,-0.121027, &
            0.150581,-0.004607,-0.436967,0.014557,-0.380418,0.018487,0.067704,-0.090621, &
            -0.080981,-0.158755,-0.442741,0.050394,-0.391648,-0.143009,-0.060359,-0.145679, &
            0.252066,0.168591,-0.232505,0.063961,0.014104,-0.036917,-0.013808,-0.140778, &
            0.191659,0.124860,-0.322878,-0.001925,0.070386,-0.111027,-0.154839,-0.225542, &
            0.169822,0.028807,-0.206781,-0.007896,0.392433,-0.078162,-0.051349,-0.056749, &
            0.152597,-0.071526,-0.291320,-0.063805,0.510388,-0.219821,-0.128085,-0.297914, &
            0.174915,0.248645,0.100633,-0.048237,0.659328,-0.049108,0.084774,-0.185430, &
            -0.136346,0.580882,0.048538,-0.251478,0.590428,-0.587200,0.096749,0.428668, &
            0.135946,0.254192,0.382765,-0.054470,-0.094796,-0.670218,0.195420,0.090257, &
            -0.027551,0.368279,0.524673,0.329721,-1.214209,-0.343114,0.131375,0.384505, &
            -0.070319,0.173665,0.194776,0.217987,-0.207406,-0.359942,-0.007085,0.091693, &
            0.134998,0.215351,0.202077,0.258335,0.109735,-0.105008,-0.453806,0.029889, &
            -0.093257,0.156522,0.183885,0.046238,0.064815,-0.104770,-0.632615,-0.325028, &
            -0.217738,-0.008661,0.210468,0.078509,-0.659587,0.077823,-0.497026,0.033125, &
            0.006127,-0.067348,-0.083477,0.135901,0.181726,-0.049670,-0.096729,-0.064471, &
            0.132971,0.144229,0.293578,-0.100313,1.199471,-0.164141,0.261317,0.106976, &
            0.119716,0.354031,0.485494,-0.216342,2.014583,0.010415,0.343683,0.349289, &
            -0.105662,-0.090949,-0.146916,0.008312,-0.240666,0.152298,-0.045818,0.093839, &
            0.041381,0.029575,-0.217032,-0.114660,-0.009558,0.183686,0.008844,-0.112248, &
            -0.045447,0.096678,-0.040816,-0.123680,0.105004,0.239166,0.029115,-0.096490, &
            -0.031839,-0.008235,0.010697,-0.083357,-0.086540,0.097499,0.016514,0.009899, &
            0.018536,-0.085289,0.024995,-0.247678,-0.039352,0.130717,0.058045,0.002761, &
            -0.018673,0.064902,-0.015819,-0.174437,-0.070385,0.246646,0.098070,-0.028503, &
            0.054174,-0.120067,-0.028306,-0.214861,0.157321,0.051748,0.008590,-0.033559, &
            -0.116478,-0.051753,-0.041128,-0.006052,-0.092768,0.085887,-0.060432,-0.035439, &
            -0.051721,0.076172,-0.065829,0.049755,0.060367,0.019490,-0.014425,-0.110931, &
            0.033264,0.117619,0.129404,0.179126,0.340259,-0.096795,-0.064856,0.050066, &
            0.265173,-0.107622,-0.002397,-0.228945,-1.409548,-0.070646,0.049976,0.058234, &
            -0.084803,0.097821,-0.053164,-0.077415,1.021951,0.193761,0.365248,-0.009291, &
            -0.311490,-0.190161,-0.021838,-0.099536,1.001898,0.157325,0.013292,-0.064804, &
            -0.177319,-0.214797,-0.015199,0.009379,-0.904918,-0.047678,-0.206125,-0.016592, &
            0.030258,-0.060787,-0.025894,0.011193,-0.442101,-0.148263,-0.099545,0.017878, &
            0.020933,0.025006,-0.054964,0.117706,0.412289,0.041619,-0.454413,-0.182595, &
            0.039432,0.070037,0.101422,0.108058,-0.768591,0.000236,-0.128184,0.078192, &
            -0.100208,0.218465,-0.026906,0.220009,0.891781,0.158861,0.253868,0.050917 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-1.214192,0.035936, &
            1.686832,-0.594222, &
            0.085473,-1.547271, &
            -1.389175,0.423005, &
            0.664160,-0.392655, &
            -1.545536,0.766088, &
            -0.918759,-0.127103, &
            0.799523,1.300988 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/1.971129,1.26983/),(/1,2/))
real, dimension(8) :: bias1 = &
(/-1.117366,1.203911,-1.095354,-1.415305,0.654356,-1.471217,-1.34701,0.400384/)
real, dimension(2) :: bias2 = &
(/0.487228,0.038358/)
real, dimension(1) :: bias3 = &
(/-0.305859/)
contains
subroutine fnet_MTZ_initall()
end subroutine fnet_MTZ_initall
subroutine fnet_MTZ_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_MTZ_engine
end module fnet_MTZ
