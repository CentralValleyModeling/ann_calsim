module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
 Reshape((/-0.295977,-0.301586,-0.225287,-0.034366,0.029391,-0.043645,0.480014,-0.184424 , &
-0.139172,-0.179647,0.161184,0.216166,-0.048217,-0.086159,-0.381285,-0.070623 , &
-0.327312,-0.017083,0.048149,0.135786,-0.116705,-0.087027,-1.258222,-0.028787 , &
-0.282393,-0.105968,0.07245,-0.016496,-0.053635,-0.041048,-0.725199,-0.071170 , &
-0.339625,-0.148679,-0.066533,0.108085,-0.081898,0.006378,-0.102495,-0.079654 , &
-0.307054,-0.048171,-0.304789,0.203079,-0.178963,0.096115,-0.233354,0.040650 , &
0.157301,0.03609,0.049361,0.094006,-0.083097,-0.008996,-0.059972,-0.012622 , &
0.130095,0.059965,-0.169964,-0.000818,-0.02099,-0.026598,0.731512,-0.062743 , &
-0.655278,-0.422289,-0.125697,0.302664,0.031413,-0.231353,0.023796,-0.450257 , &
-0.038366,-0.036657,-0.192431,-0.039505,0.027285,-0.412018,0.574292,-0.581415 , &
-0.019165,0.032363,0.405653,0.920544,-0.462807,0.048756,0.147157,0.004193 , &
-0.308474,-0.16678,0.017893,1.571013,-0.645072,-0.101801,-0.031158,-0.341719 , &
-0.528683,-0.140792,-0.538581,0.728793,-0.327969,-0.115983,0.481268,-0.282079 , &
-0.113994,-0.132061,-0.625449,1.350058,-0.236949,-0.207108,-0.414834,-0.440006 , &
-0.648644,-0.122325,-0.155772,0.658812,-0.411804,-0.210269,1.782662,-0.247355 , &
0.146057,-0.084761,-1.236694,0.066128,0.024922,-0.236701,0.598267,-0.391263 , &
-0.585149,0.294722,-1.936394,-0.421159,0.137038,-0.321839,0.064206,-0.023554 , &
-0.214695,0.129937,-0.328697,0.042726,-0.276162,-0.376356,2.063093,-0.301320 , &
0.333363,0.009197,-0.012087,-0.102511,0.274982,0.129122,-0.512343,0.314277 , &
0.482346,0.115798,0.195935,-0.546371,0.117199,-0.202283,-0.380166,0.023957 , &
0.615857,0.251611,0.220937,-0.367505,0.156221,-0.162668,0.121484,0.081815 , &
0.282678,0.136411,0.494834,-0.555786,0.112252,-0.144086,0.118594,0.090418 , &
0.309076,0.086547,0.399776,-0.549096,-0.00779,-0.205429,-0.520209,0.035299 , &
0.173064,-0.133674,0.110515,-0.245189,-0.010774,-0.148501,-0.263331,0.030100 , &
0.37603,-0.177791,-0.186645,-0.421174,0.200154,-0.272995,-0.07048,-0.072584 , &
0.368529,-0.179863,-0.300207,-0.128911,-0.133392,-0.123082,-0.201036,0.231909 , &
-0.407659,-0.076087,0.801547,-0.886962,-0.268632,-0.222468,-0.470383,0.419275 , &
0.000774,-0.288846,-0.1778,-1.104264,-0.059521,-0.312114,-1.857397,0.157187 , &
0.03509,0.014425,0.988976,-2.139492,0.343436,-0.370074,-2.585666,0.118716 , &
0.493875,-0.311491,1.395223,-0.66693,0.742746,-0.296468,-0.629624,0.049942 , &
0.506664,-0.403621,0.456334,-0.755247,0.903266,-0.078656,0.124074,0.011709 , &
0.834557,-0.272129,-1.160516,-0.2899,0.492903,-0.080109,-1.126184,-0.243873 , &
-0.24133,-0.29614,0.568606,-0.408868,0.31283,0.134682,-2.536492,0.003865 , &
0.020709,-0.635561,0.52608,0.62875,0.523404,-0.036348,0.501646,0.168529 , &
0.123062,-0.498465,-0.308258,-0.174802,-0.036322,0.149604,2.059072,-0.236201 , &
0.940722,-0.494147,1.641819,-0.545528,0.475131,0.341993,-1.467739,0.184927 , &
1.369738,4.585903,3.415056,-2.601961,5.163703,5.166442,-2.892039,2.480339 , &
1.221992,4.377199,3.448472,-2.131566,5.39714,4.943644,-2.292689,2.695730 , &
1.524381,3.881292,3.11414,-2.154474,4.922827,4.452339,-2.478545,2.718895 , &
1.502095,3.919798,2.874033,-1.916765,4.748089,4.35097,-2.572931,2.852648 , &
1.484063,3.597011,2.68336,-1.662486,4.667377,4.35612,-2.739372,2.563493 , &
1.198378,3.713069,2.841759,-1.751484,4.940569,4.647525,-2.710561,2.506300 , &
1.269151,4.035907,2.733988,-1.14058,5.322203,4.805172,-2.120707,2.117582 , &
0.897078,4.137445,3.101479,-1.098627,5.207878,5.024159,-1.671734,1.725526 , &
-0.573034,6.309097,3.95996,0.642413,6.86781,6.663498,0.760141,-0.643901 , &
0.248698,5.33978,2.425612,0.160765,5.439366,6.021257,0.772677,-0.290993 , &
0.57193,3.797829,1.352957,-0.408388,3.569249,4.880408,-0.043286,0.265682 , &
0.994291,2.039096,0.217109,-1.460424,1.702322,3.035149,0.349101,1.642324 , &
0.811099,0.922215,0.082663,-2.345388,1.312388,1.512506,0.968504,1.759061 , &
0.791676,0.750637,-0.775138,-2.191737,1.204993,1.031207,0.840879,2.181952 , &
0.800896,0.661577,-0.325803,-1.667332,0.674557,0.687312,0.337443,1.115166 , &
0.509007,0.531025,0.053934,-1.579713,1.306326,0.670412,0.445095,1.239481 , &
0.212816,0.615997,0.855574,-2.018668,0.88402,0.843614,0.547965,1.265307 , &
0.395429,0.502732,1.38938,-1.605461,0.805308,0.963892,0.006914,1.262761 , &
1.716103,0.920683,-0.22201,-0.752334,0.205099,1.028665,-0.92271,0.699262 , &
1.521625,0.798705,-0.140173,-0.776428,0.283041,0.903262,-0.688129,0.830743 , &
1.535646,0.918815,-0.294402,-0.840012,0.183172,1.027474,-1.015228,0.689527 , &
1.56881,0.687642,-0.481267,-0.759523,0.207388,1.323808,-0.880349,0.438892 , &
1.524674,0.940732,-0.282963,-0.704966,0.465162,1.037683,-0.820193,0.312299 , &
1.501128,0.989944,-0.462426,-0.680654,0.256122,1.421675,-0.720714,0.211063 , &
1.82472,1.01877,-0.416019,-0.57199,0.183456,1.418316,-0.783123,0.344777 , &
1.688389,0.96279,-0.321187,-0.41864,0.577234,1.161451,-0.591333,0.128687 , &
1.679967,1.04264,-0.820776,-0.503792,0.30666,1.48175,-0.943422,-0.001537 , &
1.472267,1.201329,-0.743287,-0.184242,0.576901,1.218955,-0.716306,-0.179924 , &
0.841479,1.045954,-0.812751,-0.1209,0.784022,0.854627,-0.951447,0.459408 , &
0.526235,0.849962,-0.692474,-0.194218,1.094001,0.319243,-0.671484,0.254343 , &
0.974071,0.408818,-1.32899,-0.356056,0.936095,-0.121965,-0.755919,0.580262 , &
1.512685,0.314612,-1.62084,-0.577539,0.508587,-0.26268,-0.861698,0.263825 , &
1.611536,0.431714,-1.449864,-0.824426,0.444832,-0.21552,-0.811918,0.093052 , &
0.664328,0.700838,-1.139055,0.049764,0.701079,-0.009571,0.287655,-0.208000 , &
0.335307,0.503005,-0.59485,-0.42593,0.657709,-0.093443,0.460252,0.414637 , &
0.170279,0.783163,-0.246448,-0.035323,1.265061,0.037703,0.377722,0.358304 , &
-0.529055,-0.23301,-0.458061,0.928709,-0.45804,-0.317731,-0.985666,0.193927 , &
-0.34117,-0.115271,0.0719,0.616002,-0.149187,-0.058896,-0.375053,0.167479 , &
-0.384431,-0.155722,-0.023103,0.372897,-0.261555,-0.00622,0.133733,0.001942 , &
0.010226,-0.07098,0.011173,0.23551,0.008653,-0.073944,0.352087,-0.122967 , &
0.087676,0.013321,-0.229682,-0.136303,0.175403,-0.232016,0.291641,-0.169106 , &
0.002692,0.084596,0.044183,-0.272764,0.005875,0.090978,0.000273,0.115206 , &
-0.067923,-0.003627,0.0864,-0.169388,0.169892,0.001135,-0.488338,0.025858 , &
-0.04413,0.156113,-0.368943,-0.24054,0.139183,0.18641,-1.574533,0.125122 , &
-0.08285,-0.46792,-0.468172,0.020781,-0.298591,-0.175711,-1.7559,0.286121 , &
-0.717188,0.318121,0.995916,0.261309,0.258206,0.569429,-1.002265,-0.210147 , &
0.091688,-0.267301,0.730672,-0.260111,-0.590896,-0.510994,0.272687,0.208449 , &
-0.517376,0.004272,1.534073,-0.281278,-0.27272,-0.002657,0.554434,-0.011849 , &
-0.884844,-0.318252,1.14637,0.124304,-0.719561,0.063452,-0.432221,0.577317 , &
-0.407173,0.177663,1.531288,-0.422296,0.160225,0.492496,0.223049,0.217261 , &
0.714536,-0.272668,0.612234,-0.431549,-0.660946,-0.502934,0.729817,0.416440 , &
0.467621,0.452838,0.477492,0.315194,-0.118257,0.203319,1.672148,-0.316011 , &
-0.454706,0.514622,-0.216798,-0.33395,0.044122,0.34511,-0.908791,0.296207 , &
-0.178898,0.284985,0.017731,0.03494,-0.151557,0.436977,0.337546,0.082136 , &
-0.45428,-0.090267,0.170775,0.560312,-0.439788,-0.334605,-0.672612,-0.624819 , &
-0.386105,-0.380019,-0.119683,0.462882,-0.369077,-0.131216,-0.347393,-0.289185 , &
-0.286274,-0.40337,0.304171,0.616932,-0.284284,-0.243166,-0.249671,-0.438067 , &
-0.449139,-0.139556,0.039004,0.552129,-0.309197,-0.323114,-0.275678,-0.513613 , &
-0.478048,-0.129165,0.173294,0.515061,-0.440926,-0.389159,0.302434,-0.429513 , &
-0.225462,-0.429902,0.156235,0.407786,-0.38906,-0.181125,0.430336,-0.675792 , &
-0.305936,-0.18333,0.042506,0.392226,-0.40532,-0.333867,0.206095,-0.534184 , &
0.035092,-0.416892,-0.255663,0.284587,-0.332526,-0.348257,0.046984,-0.574422 , &
-0.033505,-0.550505,0.119784,0.443106,-0.630987,-0.703338,0.149688,-0.268196 , &
-0.216104,-0.673225,0.376081,0.417628,-0.355372,-0.914631,1.359785,-0.408715 , &
-0.497194,-0.357517,0.907692,0.584984,-0.198455,-0.564863,1.635555,-0.568330 , &
-0.096533,-0.46352,0.68704,0.749286,-0.40878,-0.237617,0.802831,-0.390426 , &
-0.477846,-0.272504,0.309076,0.522017,-0.265289,-0.447401,0.362164,-0.493160 , &
-0.273782,-0.085197,-0.025791,0.438679,-0.558286,-0.245473,1.014519,-0.473254 , &
0.005517,-0.274319,-0.273424,0.401691,-0.514065,-0.167454,1.115043,-0.355195 , &
-0.159653,-0.027013,-0.695394,0.271675,-0.249345,0.021542,-0.105718,-0.366770 , &
0.165277,0.118272,-1.038955,-0.111063,-0.4377,0.11647,-0.898684,-0.097102 , &
0.264748,-0.013255,-0.353712,0.237267,-0.38568,0.179742,-0.336326,0.012016 , &
0.437851,0.425596,0.170783,-0.202294,0.026595,-0.043836,0.667603,0.248202 , &
0.143392,0.046635,0.427416,0.065931,0.039489,-0.042597,0.143963,-0.016926 , &
0.183851,0.142877,-0.307551,-0.177563,0.071044,-0.097942,-0.54817,-0.099321 , &
0.089675,0.183585,-0.214811,-0.233453,-0.043232,-0.027639,0.069064,0.030188 , &
-0.179226,0.173509,0.110001,0.140615,-0.131331,-0.094342,0.468598,0.023084 , &
0.04135,0.137067,0.351943,0.216096,0.053148,-0.09583,0.642228,0.075482 , &
-0.004086,0.20996,0.08769,0.20501,-0.042215,-0.110488,0.485383,0.052724 , &
0.069983,0.114071,-0.32148,0.183782,-0.020494,0.151821,0.571838,0.269202 , &
-0.081002,-0.008285,0.354517,0.518882,-0.33307,0.006037,-0.219979,-0.111631 , &
-0.246975,-0.368906,0.118565,0.156921,-0.003878,-0.07137,-1.358485,-0.433602 , &
0.491099,-0.107482,0.473185,0.270051,0.197284,-0.094326,-1.269629,-0.293726 , &
0.113214,-0.28538,0.150837,-0.288665,-0.120042,0.089485,-2.945295,-0.335018 , &
0.265179,0.194407,-0.193308,0.179054,0.187917,0.096757,-2.318843,0.403550 , &
0.103565,0.093662,-0.148584,0.156578,0.222163,-0.230541,2.429644,-0.055818 , &
-0.268323,0.056619,-0.360162,-0.493704,-0.090874,0.023913,-1.056787,-0.039366 , &
0.03221,0.044864,0.096595,-0.381036,0.39861,-0.166706,-1.863219,-0.043429 , &
0.401962,-0.045273,0.036639,-0.437438,0.303004,0.074423,-0.199372,0.095349 , &
-0.255446,-0.041259,-0.431965,-0.228042,0.19254,0.066039,-1.99485,0.034274  &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
 Reshape((/0.136265,1.189282 &
			,1.129859,-1.627243 &
			,0.709155,-0.934738 &
			,0.598031,-0.532242 &
			,0.977398,-1.678767 &
			,1.150351,-2.272549 &
			,1.800601,-0.406054 &
			,-0.354411,1.414606 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-0.454259,3.47652/),(/1,2/))
real, dimension(8) :: bias1 = &
(/2.118826,-2.166518,-0.89751,-2.128075,-2.260433,-2.134529,-0.139173,2.301082/)
real, dimension(2) :: bias2 = &
(/-0.670727,0.901491/)
real, dimension(1) :: bias3 = &
(/0.374469/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  !integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
