module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/0.129377,0.071482,-0.083697,0.099999,-0.164948,-0.226842,-0.086682,-0.161778, &
            -0.237240,0.064927,-0.208757,0.024641,0.058124,-0.186402,-0.269187,-0.203575, &
            0.116836,0.266069,-0.134443,-0.049869,0.111467,-0.077547,-0.028209,0.015840, &
            0.014777,0.113742,0.009355,-0.238758,-0.064358,-0.035251,-0.150467,0.033936, &
            -0.103618,0.093532,0.000963,0.079260,-0.221654,0.102583,0.052549,-0.261526, &
            -0.207700,0.317526,-0.058574,-0.225861,-0.195743,0.124935,0.032677,-0.160131, &
            -0.208086,0.037432,-0.215012,0.076427,-0.073469,-0.006874,0.142094,-0.230393, &
            0.022831,0.158310,0.139213,-0.056583,-0.082366,0.112346,-0.188443,-0.227304, &
            -0.253594,0.309426,-0.138774,-0.052121,0.037396,-0.228369,-0.191389,0.038862, &
            -0.095698,0.314163,-0.105577,-0.086566,-0.017730,-0.237778,-0.071960,-0.281075, &
            -0.200141,-0.081060,0.007271,-0.290310,0.053516,-0.165684,0.097940,-0.142164, &
            -0.135607,0.047089,-0.250878,0.011725,0.041044,-0.117255,-0.227047,0.110894, &
            0.087892,0.228900,-0.070874,-0.001767,-0.253640,-0.135572,-0.124433,-0.040544, &
            0.009789,0.069904,0.044365,0.044723,-0.096759,-0.101804,0.067174,-0.210404, &
            0.055566,-0.019417,0.129967,0.013177,-0.168604,-0.224925,-0.213788,-0.104228, &
            -0.027055,0.005353,0.016000,0.097523,0.072130,-0.048816,-0.183105,0.107396, &
            0.147661,0.077815,-0.133774,-0.147780,0.008848,-0.165543,-0.105261,0.104597, &
            -0.032844,-0.041614,-0.246571,-0.141098,0.104525,-0.004777,-0.035323,0.042669, &
            0.045315,0.212110,0.052668,-0.175224,-0.020946,-0.149046,0.128715,-0.036907, &
            -0.006368,-0.089336,-0.022626,-0.199840,0.048271,-0.170011,0.038024,0.042596, &
            -0.054783,-0.078715,-0.278488,0.072470,0.040279,0.039095,-0.254631,0.054729, &
            -0.217215,0.299649,-0.159943,-0.103658,-0.057996,0.081289,-0.100674,-0.121918, &
            -0.078634,-0.052751,0.021342,-0.025661,0.109040,0.042476,0.058413,-0.171727, &
            -0.152036,-0.048707,-0.130547,-0.065792,-0.014323,-0.191559,-0.212613,0.080876, &
            0.078218,-0.029498,-0.209223,0.067772,-0.191916,-0.188826,-0.034662,-0.143042, &
            0.056204,0.024437,-0.085607,0.090215,-0.094762,-0.082169,-0.140659,-0.262846, &
            -0.225759,0.126777,-0.121263,0.123639,-0.177637,-0.040457,-0.060471,-0.139161, &
            -0.200527,-0.014913,0.118978,-0.138483,-0.072394,-0.061975,-0.204467,-0.190752, &
            0.148439,-0.001100,0.038206,-0.070540,0.084440,0.098616,-0.198089,0.022482, &
            -0.168341,0.156153,-0.129579,-0.189851,0.047073,-0.238338,-0.102644,-0.000710, &
            -0.193130,0.230600,-0.165756,-0.026533,-0.046002,0.076072,-0.126458,-0.051612, &
            0.071487,-0.019123,-0.174034,0.002238,-0.313230,-0.112390,-0.246695,0.082704, &
            -0.108713,0.210352,-0.198775,-0.159553,0.093089,-0.043727,-0.174423,-0.198857, &
            -0.043333,0.011778,0.082626,-0.015295,0.089632,0.104518,-0.074727,-0.268897, &
            -0.230033,0.081458,0.011867,-0.093068,0.026459,-0.020910,0.114765,0.083834, &
            0.048103,0.033610,0.046014,-0.082632,0.049184,0.028382,-0.225289,-0.117740, &
            -0.107363,0.154324,0.030508,-0.237077,-0.021273,-0.106847,0.049707,-0.136135, &
            -0.107885,0.018344,-0.017237,-0.218167,-0.216750,0.086541,0.009075,0.107231, &
            -0.122844,0.131826,-0.023520,-0.291875,-0.232644,0.004917,-0.207940,-0.236206, &
            -0.053792,0.068663,-0.283638,-0.045581,0.098981,-0.132268,-0.199563,-0.142748, &
            -0.225637,0.128240,-0.181863,0.123430,-0.233785,0.104036,-0.013411,0.022660, &
            0.075148,0.116883,-0.263318,0.012720,0.053333,-0.116893,0.108613,-0.129249, &
            -0.183182,0.288718,-0.045789,-0.271084,-0.193935,-0.286647,0.059753,0.127988, &
            -0.132045,0.137308,-0.199771,-0.189716,0.014975,0.097131,0.065735,-0.166944, &
            0.119160,-0.076744,0.135372,-0.025420,0.043518,-0.273303,-0.195422,-0.012877, &
            -0.265603,-0.077444,0.012933,-0.043385,-0.210263,-0.061861,-0.253732,-0.236070, &
            -0.179210,0.013087,-0.279207,-0.253167,-0.178509,-0.205486,0.001147,-0.109046, &
            0.050836,-0.037968,-0.098438,-0.149463,-0.056116,-0.245887,-0.070416,-0.246505, &
            -0.011451,0.200907,0.000478,-0.005662,-0.024592,0.091016,-0.265766,-0.249443, &
            -0.254054,0.110591,-0.128917,-0.281689,0.051097,-0.113111,-0.008859,0.068174, &
            0.118375,0.323760,-0.164583,-0.180663,-0.267372,-0.017945,0.076902,0.093874, &
            -0.065146,0.221947,-0.245240,-0.288262,0.061776,-0.189780,0.067816,-0.078466, &
            -0.202385,0.237288,0.022414,-0.091401,-0.012285,0.087988,-0.226409,0.092169, &
            -0.058414,0.054924,-0.124066,0.114673,-0.199602,-0.075539,-0.213109,-0.054026, &
            -0.049307,0.102221,-0.119115,-0.174764,-0.215569,-0.250910,0.079149,0.067824, &
            0.114950,-0.088683,0.036245,-0.158677,-0.236183,0.005928,-0.083076,-0.091719, &
            -0.165576,-0.055049,-0.230787,0.058216,-0.085132,-0.108337,-0.118991,0.079747, &
            0.072967,0.020559,-0.159072,-0.189313,-0.102210,0.081026,-0.056790,-0.019726, &
            -0.238650,-0.070622,-0.084588,-0.269422,0.052877,0.044605,-0.205270,-0.085201, &
            -0.036748,0.268253,0.036864,0.098982,-0.155374,0.097299,0.098540,0.033270, &
            -0.044552,0.015342,0.123191,0.005499,0.106889,-0.237827,-0.000876,-0.043504, &
            0.039204,-0.074680,-0.082767,0.105420,-0.226740,0.116460,0.127886,-0.116115, &
            0.023825,0.077755,-0.051229,-0.124786,-0.054204,-0.283822,-0.111523,0.099230, &
            -0.186282,0.157066,-0.093326,-0.204600,-0.246286,0.024801,-0.276813,-0.246550, &
            -0.048612,0.101367,-0.171144,-0.086260,-0.057329,-0.243579,-0.164245,-0.004564, &
            0.014594,0.155096,0.032701,-0.093627,-0.111191,-0.013293,0.135458,-0.198481, &
            -0.113473,0.273927,-0.007238,-0.242052,-0.075562,-0.281586,-0.124180,0.126392, &
            -0.037047,0.177070,-0.195138,0.111442,0.007836,-0.292101,-0.063024,-0.080906, &
            -0.106907,0.170638,-0.277163,0.113471,0.078882,-0.270117,0.015136,-0.032126, &
            -0.011934,0.317447,-0.247031,0.081223,-0.069188,-0.038134,-0.104796,-0.098470, &
            -0.028618,-0.054334,-0.013867,0.008193,-0.032820,0.090494,0.059295,-0.136239, &
            -0.106146,0.137859,0.107835,-0.197251,-0.032621,-0.251297,-0.180359,-0.157462, &
            -0.099918,0.122493,-0.096751,-0.201502,0.063753,0.012016,-0.103537,-0.088490, &
            -0.070559,-0.080108,0.016998,-0.215317,-0.034385,-0.280171,-0.037041,-0.118915, &
            0.116581,0.067452,-0.092512,-0.007323,-0.169347,-0.204080,-0.194656,-0.183340, &
            -0.152000,0.200570,-0.151063,-0.187799,-0.241531,-0.000414,0.128987,-0.063432, &
            -0.110942,0.094709,0.086201,0.107045,-0.194124,0.101578,0.139431,0.093874, &
            -0.149583,0.185822,0.139030,0.122846,-0.225230,-0.267061,-0.184389,-0.172014, &
            -0.049318,0.010798,-0.216074,-0.133267,0.095847,-0.104495,-0.059753,0.090309, &
            0.077564,0.165122,0.086298,0.073901,-0.303058,-0.139855,-0.092521,-0.173797, &
            -0.030918,0.029301,0.133728,-0.079067,-0.099006,0.024206,0.001543,0.066722, &
            -0.097929,0.290084,0.005223,-0.288658,-0.022378,0.081842,-0.091890,-0.096691, &
            -0.131709,-0.064523,-0.059818,0.120074,0.006266,-0.219226,-0.095766,-0.191678, &
            -0.168645,0.139855,-0.148882,0.096129,0.111600,0.033377,-0.035729,-0.096740, &
            -0.224455,0.165456,-0.076908,-0.136717,-0.204177,-0.003447,0.028406,-0.009238, &
            -0.123699,-0.090748,0.045347,0.017590,0.067634,-0.051940,-0.079154,-0.219678, &
            -0.245159,0.190228,-0.019084,-0.090745,-0.300822,-0.062764,-0.192181,-0.222516, &
            -0.036822,0.104709,-0.131463,-0.188987,0.065627,-0.030736,-0.125786,0.117193, &
            0.004345,0.025738,0.089429,0.045401,-0.227053,-0.153596,0.047454,0.111594, &
            -0.169186,0.066730,-0.232340,0.004755,0.053457,-0.017293,0.016477,-0.018856, &
            -0.155511,-0.016199,-0.101801,-0.244644,-0.237795,-0.089825,-0.196676,-0.127089, &
            -0.214048,0.126702,-0.267089,0.086509,-0.083688,0.078067,-0.032436,-0.214288, &
            -0.229210,-0.015754,0.102008,0.126306,-0.134337,-0.119653,-0.236808,-0.076590, &
            -0.087233,-0.020639,-0.198089,-0.115408,-0.065420,0.117744,-0.191940,-0.163142, &
            0.017245,0.104714,0.116239,0.062117,0.033177,-0.010253,-0.077423,0.049863, &
            -0.008685,0.085198,-0.226537,-0.203205,-0.165510,-0.026703,-0.230888,0.057552, &
            -0.029553,0.008084,-0.266436,0.092371,-0.104554,-0.285591,0.026692,-0.115341, &
            -0.173876,0.197238,-0.091803,0.077844,-0.000458,-0.134574,0.129323,-0.244674, &
            -0.028412,0.029349,-0.124579,0.094727,-0.230527,0.046466,-0.221485,-0.158552, &
            -0.191297,0.211498,0.139429,-0.069583,-0.303006,-0.123765,-0.197858,-0.048378, &
            -0.199391,-0.067153,-0.128477,-0.032441,-0.062298,0.012556,0.100503,0.085678, &
            -0.120099,0.036307,-0.180434,-0.043302,0.028428,-0.285801,-0.062993,-0.064251, &
            -0.079857,0.255862,0.082308,-0.228959,-0.140799,-0.047617,0.023359,0.073082, &
            -0.261260,0.178195,-0.197906,-0.007503,-0.043569,0.122827,0.023768,0.024947, &
            0.031418,0.131469,-0.032511,-0.266040,-0.283793,-0.201313,0.039011,-0.084526, &
            0.085399,-0.045735,-0.142113,-0.239243,-0.094819,0.007140,-0.009837,-0.100576, &
            0.126656,0.095313,-0.068981,0.095804,-0.275316,-0.092124,-0.080921,0.106779, &
            -0.030804,-0.074714,-0.247643,-0.220332,0.038421,-0.059093,-0.111009,0.035534, &
            -0.136474,0.004134,-0.220754,-0.072934,0.037866,-0.276759,0.053051,-0.166904, &
            -0.020264,-0.012792,-0.150346,-0.000078,-0.088677,0.062224,-0.261492,-0.274781, &
            0.145429,-0.002467,-0.181487,-0.277137,-0.047853,0.090121,-0.223963,-0.176031, &
            -0.039094,-0.084054,-0.206097,0.082980,0.020666,-0.090631,-0.036680,-0.198524, &
            0.130369,0.038862,0.040603,-0.129757,-0.199202,0.060688,-0.037581,0.137393, &
            -0.122066,0.189893,-0.186970,-0.158397,-0.000868,-0.162322,-0.224592,-0.058120, &
            -0.053017,-0.024939,-0.046852,-0.121322,-0.275058,0.083649,0.058650,-0.098032, &
            -0.150001,0.264164,-0.190124,-0.193850,-0.295630,0.014670,-0.229275,-0.110608, &
            0.106297,-0.032751,-0.175072,0.014335,0.049011,0.078501,-0.179901,-0.058618, &
            0.028280,0.309786,0.011139,0.016319,-0.186849,0.078025,-0.033839,-0.271610, &
            -0.253147,0.127837,-0.027733,0.126961,-0.221109,0.025402,-0.098284,-0.209939, &
            -0.047725,0.204157,-0.137121,0.000425,-0.179659,-0.135532,-0.182384,-0.206376, &
            -0.136936,0.124601,0.100860,-0.256367,-0.055128,-0.282027,-0.219152,0.033612, &
            -0.149532,-0.096028,0.055921,-0.125033,-0.100563,-0.199994,0.084511,-0.214665, &
            0.048540,0.031940,0.068210,-0.244125,0.099101,-0.094422,-0.272412,0.095457, &
            -0.129460,0.291779,-0.119056,0.109920,0.005190,-0.017065,-0.239610,0.124683, &
            -0.061752,0.050078,-0.054316,-0.160617,0.027677,-0.241029,-0.024932,-0.269596, &
            -0.186961,0.098517,-0.170731,-0.123653,-0.061985,-0.035885,0.134243,-0.120680 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/0.422509,0.257317, &
            0.030347,-0.438284, &
            -0.198208,0.629387, &
            -0.303237,0.459373, &
            -0.169637,0.522319, &
            -0.615806,0.591289, &
            -0.428299,0.699321, &
            -0.645027,0.260858 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/0.847525,-1.211641/),(/1,2/))
real, dimension(8) :: bias1 = &
(/-0.056348,0.117881,-0.072849,-0.08345,-0.102723,-0.087117,-0.070802,-0.073079/)
real, dimension(2) :: bias2 = &
(/0.193899,-0.185738/)
real, dimension(1) :: bias3 = &
(/0.15853/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
