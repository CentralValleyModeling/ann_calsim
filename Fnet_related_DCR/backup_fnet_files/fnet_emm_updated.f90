module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/-0.096008,-0.281597,0.249797,-0.412095,0.522523,0.071963,0.406997,0.019391, &
            0.027684,-0.053107,0.135560,-0.080456,0.061243,1.157184,0.279369,-0.084944, &
            0.055722,-0.061599,-0.039355,0.031985,-0.009862,0.934967,0.289064,-0.100622, &
            -0.039043,-0.009116,0.162573,-0.102954,0.251943,-0.008041,0.064937,-0.029338, &
            0.128831,0.020387,-0.017711,0.046877,-0.225039,0.024437,0.185581,-0.190027, &
            -0.062832,-0.058688,0.204785,-0.097122,0.401962,-0.504508,0.081684,0.061164, &
            0.100073,0.292417,0.051015,0.091592,0.048496,-0.386748,-0.034350,0.062507, &
            0.134765,0.312442,0.248274,0.039776,0.256355,-0.251846,0.234333,-0.096380, &
            -0.244540,-0.051673,1.001532,-0.462531,-2.110099,-0.172128,0.453253,0.063185, &
            -0.205723,-0.068921,0.899876,0.256488,1.702180,-0.169174,0.958303,0.725257, &
            0.138054,-0.065090,0.178002,0.676371,-0.994744,-0.248504,0.570323,-0.170659, &
            -0.021138,-0.313804,-0.095334,-0.389119,0.361175,-0.312436,0.189272,-0.264102, &
            -0.094666,0.000448,0.105929,-0.493628,-1.358129,1.251756,0.011240,0.365960, &
            0.219415,0.497364,0.109167,-0.007168,-1.145105,-0.458067,0.355239,-0.118752, &
            0.001940,0.165387,0.264869,-0.578185,-0.854178,-0.581251,0.224287,0.692510, &
            0.042646,0.429381,0.296149,-0.299719,-1.501270,0.127631,0.146869,1.039398, &
            0.029616,0.341752,0.149346,0.249791,-0.650827,0.216981,-0.006041,0.892919, &
            0.268118,0.618312,-0.161567,0.358644,-1.180569,-0.902844,-0.310393,0.585958, &
            0.024320,0.095102,-0.270131,-0.460084,0.948395,-0.478244,-0.145400,0.179797, &
            0.136858,-0.053512,-0.090213,-0.145722,1.330249,-0.441076,-0.212458,0.061319, &
            0.099181,0.048384,-0.035644,0.006823,0.539865,-0.686757,-0.334243,-0.111033, &
            0.139852,0.049518,0.174296,0.062674,0.373308,-0.720695,-0.028490,-0.283751, &
            0.243946,0.092622,0.124832,-0.069435,0.347082,-0.582398,0.042324,-0.319362, &
            0.221545,0.074072,0.141635,-0.145518,-0.023697,0.015127,0.118122,0.194400, &
            0.228746,0.191841,0.198892,-0.204423,-0.258323,-0.146694,0.026420,0.013806, &
            0.273553,0.091140,0.148589,-0.403258,-0.236779,0.294112,0.003023,0.259306, &
            0.404875,-0.362799,0.166998,0.502365,0.572150,0.861066,-0.280690,-0.672015, &
            0.300176,-0.327566,0.383059,0.551422,2.288626,-0.298144,0.199924,-0.681385, &
            0.301501,-0.887004,0.063173,0.669604,0.195202,-0.074710,0.277908,-1.003064, &
            0.051945,-0.221399,0.036394,-0.129455,1.288823,0.800956,-0.146137,-0.740619, &
            -0.233425,0.014028,0.346578,-0.581035,2.084471,1.046350,-0.220940,-0.481653, &
            0.063086,0.592873,0.045265,-0.180319,1.159642,0.677391,-0.301377,0.872019, &
            0.144657,-0.096345,-0.177920,0.355744,1.686811,-2.255065,-0.291363,-0.364412, &
            0.246366,0.045713,-0.254949,0.101262,-0.959482,-0.677578,0.135562,-0.090038, &
            0.195159,0.263076,0.058363,0.522657,-0.747321,0.363274,0.381490,0.417084, &
            -0.514328,-0.276857,0.860041,-1.474576,3.600405,1.489006,0.022693,-1.323487, &
            -6.126697,-3.619862,-3.393146,3.365882,2.711277,2.310867,-2.567092,-2.828344, &
            -6.043731,-3.533148,-3.353359,3.322499,2.186596,2.453769,-2.826332,-2.634292, &
            -6.031077,-3.347759,-3.025714,2.836705,1.990630,2.688738,-2.826483,-2.630553, &
            -5.802815,-3.215966,-2.932771,2.724221,1.804021,2.841577,-2.908900,-2.188817, &
            -5.442557,-3.169233,-2.977874,2.882981,1.886084,2.899669,-2.585207,-2.349125, &
            -5.813037,-3.120441,-2.933337,2.677295,2.028209,2.422937,-2.458986,-2.087699, &
            -6.055951,-2.717503,-3.443217,2.786132,1.535904,2.181120,-2.337067,-2.165870, &
            -5.868775,-2.621909,-3.238778,3.158040,1.434591,2.342180,-1.910176,-2.375184, &
            -7.124047,-0.951025,-4.790077,4.032559,-0.520076,1.107293,-0.013180,-3.095817, &
            -5.980176,-1.734708,-4.752050,2.780444,-0.144234,0.540501,-0.021840,-1.355416, &
            -4.427941,-1.798271,-4.432845,1.561132,-0.202744,0.438276,0.042347,-0.646802, &
            -2.619935,-2.352126,-2.888635,0.170170,-0.107668,0.979980,-1.409502,0.053563, &
            -1.563574,-2.063242,-1.937230,0.200172,-0.078841,0.303343,-2.026906,-0.211101, &
            -1.322766,-1.669914,-1.084091,0.496055,-0.034881,0.287501,-2.116668,0.569986, &
            -0.660374,-1.048554,-0.519481,0.046055,0.218920,-0.237361,-2.114794,0.444801, &
            -0.893266,-0.701352,-0.738561,0.246159,-0.202122,0.243491,-1.488292,-0.020863, &
            -0.500541,-0.501900,-0.887580,0.723327,0.115198,0.320761,-1.209428,-0.206164, &
            -0.823234,-1.115583,-0.492611,1.105876,0.396472,0.473398,-1.160085,-0.742662, &
            -0.912000,-0.506556,-0.969748,0.248229,1.346181,0.690191,-0.740675,-0.142459, &
            -0.673507,-0.411658,-1.277268,0.145385,1.261508,0.612234,-0.685666,0.185474, &
            -0.906497,-0.235037,-1.209546,0.048376,1.230537,0.679495,-0.529158,-0.160408, &
            -0.812558,-0.236878,-1.163823,0.096783,1.043290,0.802304,-0.361850,0.008414, &
            -0.742313,-0.056904,-1.304764,-0.054055,0.905925,0.813271,-0.503762,0.066752, &
            -0.828663,-0.165867,-1.407331,-0.151939,1.061948,0.721527,-0.249850,-0.117245, &
            -0.882131,-0.142063,-1.449726,-0.122572,0.862923,0.627681,-0.449098,0.032842, &
            -0.531473,-0.142925,-1.107864,-0.195581,0.854780,0.804120,-0.137840,0.134884, &
            -0.840281,-0.342321,-1.270535,-0.487458,0.833276,1.110086,-0.196909,0.411043, &
            -0.653861,-0.139261,-1.008448,-0.344847,0.650307,0.515170,-0.166317,0.691744, &
            -0.839660,-0.204860,-0.942132,-0.228333,0.873666,0.309002,-0.090580,0.611424, &
            -0.701512,0.196362,-0.782608,0.183415,0.698774,0.389951,-0.487168,0.521675, &
            -0.317906,-0.303250,-0.317245,-0.155070,0.589360,0.576672,-0.685582,0.366337, &
            0.222650,-0.601718,-0.528214,-0.580049,0.798848,0.990440,-0.162103,0.728113, &
            0.036865,-0.790784,-0.319772,-0.256753,0.398392,1.303276,-0.011466,0.570573, &
            -0.307646,-0.339780,-0.336850,-0.193187,0.123949,1.070429,-0.085259,0.383493, &
            -0.195010,-0.543797,-0.450626,-0.547854,-0.252581,1.714189,-0.215024,0.317813, &
            -0.324929,-0.671554,-0.080770,-0.042326,-0.296599,2.050430,0.073169,0.165745, &
            0.541748,0.004275,-0.125776,-0.132410,-0.593248,0.708942,0.136804,0.112374, &
            0.014601,0.012144,0.135602,0.155656,-0.421608,1.053409,-0.046952,-0.029527, &
            0.204010,0.164027,-0.159131,-0.019802,-0.267082,1.042040,-0.056881,-0.088536, &
            -0.011894,0.001690,0.043856,-0.077241,-0.280630,0.795663,0.035750,-0.038322, &
            -0.019082,0.028706,0.184095,-0.044352,0.235696,0.707962,0.094710,0.142181, &
            -0.015523,-0.065306,0.099111,0.032581,0.161992,0.298873,0.273691,-0.085664, &
            0.032765,0.096757,-0.137732,0.028424,0.304818,0.199833,-0.081999,-0.240053, &
            -0.047170,-0.019448,-0.228365,0.446071,0.967998,0.143292,0.072823,0.157474, &
            0.482121,-0.344621,-0.285680,0.089191,0.999920,0.100293,0.063622,0.575145, &
            -0.189534,0.225363,-0.923113,1.381211,1.330627,1.906189,-0.047657,-0.494174, &
            0.487109,-0.301217,0.358542,0.074059,0.819670,0.078054,-0.340214,-0.110806, &
            0.129858,-0.069999,0.083821,0.780330,-0.112640,0.237791,-0.205601,-1.008578, &
            -0.085419,-0.706785,-0.228304,0.971970,1.085078,0.483934,-1.024903,-0.796822, &
            -0.189317,-0.240774,-0.478407,1.207025,2.229693,-0.295295,-0.359232,-1.048833, &
            0.533671,-0.062131,0.399804,0.130802,0.132790,1.516388,-0.169427,-0.503415, &
            -0.179903,0.774882,-0.067530,-0.191722,-0.452399,-1.067137,0.073710,-0.060387, &
            -0.384791,-0.131283,-0.598861,0.328213,0.134104,0.186513,-0.581636,0.033631, &
            -0.164079,-0.121878,-0.352142,0.305947,0.371641,0.740697,-0.528431,-0.028268, &
            0.196872,0.384128,0.031164,-0.059856,-0.040780,0.355944,0.393711,-0.245919, &
            0.456267,0.503105,0.104290,0.009453,-0.247146,0.094642,0.226554,-0.240503, &
            0.180513,0.223909,0.018988,0.045240,-0.087824,-0.265459,0.121499,-0.398900, &
            0.301524,0.536135,0.229928,0.302371,-0.405179,-0.401420,0.176277,-0.167621, &
            0.273552,0.560445,0.056111,0.039688,-0.506066,-0.450277,0.128650,-0.129081, &
            0.332174,0.305461,0.318221,0.088450,-0.732930,-0.482135,0.450651,-0.049280, &
            0.432131,0.591259,0.071650,-0.185247,-0.282334,-0.677342,0.233147,-0.115352, &
            0.325764,0.178602,0.289101,-0.209333,-0.140389,-0.443423,0.206243,0.226182, &
            0.706072,0.233470,0.544023,-0.280199,-0.355469,-0.671907,-0.058530,0.043904, &
            0.529612,0.694143,0.316549,0.148364,-1.724567,-0.506859,0.148259,-0.400482, &
            0.389534,0.411867,0.283836,0.158393,-1.355306,-0.577717,0.318334,-0.597196, &
            0.409873,0.073928,-0.064578,-0.581226,-0.111018,-0.136649,0.417250,-0.643695, &
            0.363097,0.261771,-0.066816,-0.429359,0.548610,-0.527374,0.420640,-0.252950, &
            0.235810,0.707313,-0.300940,-0.156713,-0.312374,-0.854419,0.807423,-0.220060, &
            0.803123,0.146070,-0.009478,-0.657080,-1.001299,-1.050334,-0.042507,0.080574, &
            0.086848,0.823069,-0.450882,0.086249,-0.616146,-0.970584,0.194941,0.183212, &
            0.431102,0.576278,-0.372106,-0.303723,0.188911,-0.765244,0.066944,0.586933, &
            0.201882,0.240686,-0.094732,-0.580105,0.335496,-0.475032,0.008256,0.382712, &
            -0.141641,-0.287192,0.093290,1.460434,-0.119559,1.169948,-0.164478,0.117189, &
            -0.053146,-0.171984,0.188558,1.400621,-0.133707,0.279720,0.093162,-0.214642, &
            0.097419,0.239383,0.060420,0.219732,-0.298667,-0.488340,0.153733,0.131497, &
            0.000238,0.114079,0.122085,0.022013,-0.122410,-0.061569,0.205568,0.247545, &
            0.063296,0.042543,-0.115488,0.143968,-0.631934,0.338861,-0.085345,-0.181416, &
            -0.022010,0.003350,0.031581,0.149002,-0.458369,0.139265,-0.015996,-0.122217, &
            -0.031148,0.002344,-0.054265,0.122806,-0.059652,-0.067658,-0.193262,-0.010645, &
            -0.048532,0.029242,-0.094826,0.041278,-0.726350,-0.228796,-0.146730,0.268522, &
            0.027562,-0.188615,-0.142158,0.522647,-0.058241,-0.722485,-0.133126,-0.020301, &
            -0.082720,-0.046333,0.333016,-0.990877,2.153730,2.802097,0.589673,-0.665901, &
            0.127998,0.442826,0.001363,0.509225,2.696920,3.294975,0.120102,-0.370311, &
            -0.031367,-0.071043,0.050701,-0.389760,2.021572,-1.149094,-0.002615,0.018248, &
            -0.126002,-0.106224,-0.159137,-0.102579,3.308164,1.725042,-0.327272,0.054643, &
            0.018755,0.065773,-0.070589,0.026226,0.652787,-0.190699,-0.061982,-0.147304, &
            -0.030999,-0.081993,0.140308,0.028644,-0.398640,0.225640,0.191370,0.353103, &
            -0.091260,-0.017482,0.327833,0.295197,1.399140,-0.072594,0.172450,0.011580, &
            -0.047782,-0.148010,0.237499,-0.202631,1.188889,-0.623314,0.525880,0.041824, &
            0.000382,-0.045824,-0.170417,-0.043071,0.899979,-0.291357,0.191051,0.312359 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-3.932205,-4.973266, &
            0.672696,0.735250, &
            -3.667420,-3.980284, &
            1.288327,1.076901, &
            0.052352,-0.654922, &
            -1.044074,0.285228, &
            0.856854,0.453134, &
            -1.806682,-2.695502 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-0.810204,-1.37686/),(/1,2/))
real, dimension(8) :: bias1 = &
(/1.477338,-1.163326,1.284336,-0.761001,0.204724,0.128373,-1.736457,0.481846/)
real, dimension(2) :: bias2 = &
(/0.047559,0.115073/)
real, dimension(1) :: bias3 = &
(/1.534019/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  !integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
