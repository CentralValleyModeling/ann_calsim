module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/0.033190,-0.260392,0.243114,0.092959,-0.042260,-0.190605,-0.047440,0.050002, &
            0.041056,-0.202118,0.120081,0.071184,-0.125176,0.023437,-0.226042,-0.089359, &
            -0.054789,-0.109616,-0.001391,0.085583,-0.047852,0.038185,-0.162301,0.105257, &
            0.014023,0.056810,-0.083387,0.039998,-0.017159,0.054448,-0.139802,0.107084, &
            0.120265,0.010351,0.004010,0.041143,-0.110997,-0.102211,-0.154101,0.074881, &
            0.052117,-0.143481,0.043130,-0.031821,0.023733,0.134147,-0.211294,0.022742, &
            0.056371,-0.084376,0.028538,0.038654,0.012538,0.009706,-0.177831,0.181901, &
            0.100050,-0.036106,-0.022591,-0.032014,-0.156118,-0.032647,-0.079105,0.085154, &
            0.079803,-0.356538,0.593777,0.367366,-0.354509,-0.137886,-0.660975,-0.097551, &
            0.364385,-0.502102,0.462118,0.129780,-0.646577,0.248377,-0.669759,0.272245, &
            0.589498,-0.505570,0.551621,0.089741,-0.912837,-0.148695,-0.471780,-0.212715, &
            0.734067,-0.067922,-0.232480,-0.345107,-0.689974,-0.354496,-0.318721,-0.143104, &
            0.230801,-0.181987,0.114783,-0.008142,-0.411490,0.185486,-0.422234,-0.060417, &
            0.059667,-0.203537,-0.053033,0.067108,-0.305763,0.503076,-0.747695,0.425502, &
            0.155814,-0.271247,0.169901,0.178408,-0.307885,0.748463,-0.747210,0.243047, &
            0.783069,-0.308528,0.014849,0.091971,-1.317851,1.916772,-1.297411,0.455650, &
            0.512957,-0.348459,0.263297,0.052438,-0.842778,1.119918,-0.639257,-0.025886, &
            0.600532,-0.298833,-0.089682,-0.140332,-0.967041,0.496151,-0.568426,-0.114047, &
            -0.548411,-0.112822,0.077435,-0.010463,0.736822,-0.433347,0.509888,-0.113238, &
            -0.572335,-0.300966,-0.327924,-0.133278,0.636827,0.014446,0.535228,-0.078047, &
            -0.590450,-0.102081,0.003274,0.046552,0.748260,-0.242133,0.420561,0.102361, &
            -0.467802,0.042029,-0.250093,0.064429,0.681308,-0.328821,0.277195,0.194179, &
            -0.360555,0.175573,-0.384852,-0.036946,0.699028,0.013547,0.217024,0.065013, &
            -0.312615,0.166811,-0.222084,0.086325,0.500363,-0.180439,0.334301,-0.106265, &
            -0.466268,0.009783,-0.167656,0.198132,0.473154,-0.169473,0.323071,0.113577, &
            -0.414981,0.030740,-0.118502,0.261543,0.673004,0.066390,0.300322,0.101183, &
            -0.508383,-0.009532,-0.485456,0.212140,0.946359,-0.589684,0.169842,-0.342091, &
            -0.225639,-0.088693,-0.360586,0.263325,0.638167,-0.632591,1.413197,-0.143490, &
            -0.526622,-0.035471,-0.147778,0.259870,0.971241,-0.389953,1.993179,0.140129, &
            -0.419769,0.280577,-0.360053,0.358375,0.492656,-0.709222,1.094585,0.042227, &
            -0.218882,0.042551,-0.241645,0.189917,0.566767,0.345387,1.175725,0.597675, &
            -0.302857,-0.188292,-0.073516,-0.092498,0.642404,1.152376,0.300389,0.454105, &
            -0.107438,-0.073271,0.007653,-0.035960,0.304268,0.317793,0.386246,-0.046829, &
            -0.033778,0.295288,-0.217498,0.085076,-0.036954,-0.462654,0.439051,-0.195132, &
            -0.071904,0.610978,-0.320159,0.191317,0.680821,-0.106627,0.125572,0.218338, &
            -0.692284,0.356055,0.187690,0.394645,1.150478,-1.154180,0.442910,-0.117212, &
            -2.129972,2.166730,3.965454,-2.255186,2.359633,-2.744425,2.102883,-2.729000, &
            -2.339993,2.318607,4.462366,-2.074027,2.151716,-3.089920,2.223206,-2.156568, &
            -2.255690,1.977781,3.936154,-1.794733,2.346267,-2.803032,2.059714,-2.494417, &
            -2.096589,1.858774,3.870108,-1.857512,2.526775,-2.483600,2.370267,-2.678412, &
            -1.873858,2.198282,3.632055,-1.563136,2.222908,-2.516463,2.162198,-3.054997, &
            -2.042234,2.065178,3.942348,-1.980435,2.164042,-2.585546,1.990266,-2.929774, &
            -2.154345,2.167867,4.242162,-1.912743,2.249046,-2.709141,1.740697,-2.495650, &
            -2.557300,2.402760,4.518531,-2.183710,1.681965,-2.533492,1.504873,-2.470087, &
            -4.258278,4.458256,5.723303,-3.879138,0.096797,-3.612593,-0.262700,-0.831187, &
            -4.495609,4.865052,4.890072,-4.336356,-0.731981,-3.217883,-0.552939,-2.662018, &
            -4.686799,4.777608,3.625127,-3.930473,-1.618115,-2.985365,-1.063904,-3.891061, &
            -3.995047,3.304042,1.797986,-2.655302,-1.055638,-2.677583,-1.527718,-4.477386, &
            -3.402351,2.616481,1.431280,-1.897496,-0.919730,-2.184658,-1.656250,-3.781526, &
            -2.199371,1.210385,0.718152,-0.785064,0.170835,-1.207273,-0.957575,-3.471107, &
            -1.433846,0.380069,0.516706,-0.638101,0.715243,-1.006185,-0.538368,-2.176458, &
            -1.746721,0.275260,0.271818,-0.494250,0.729208,-0.768774,-0.306228,-2.184026, &
            -1.870722,0.241505,0.381792,-0.493686,0.744008,-1.203093,-0.273256,-2.247927, &
            -1.592537,0.613871,0.718892,-0.797404,1.260317,-1.236770,0.068333,-2.515834, &
            -0.053440,0.168341,0.533605,-0.559796,1.004705,0.407632,1.079873,-0.742435, &
            -0.237518,0.530784,0.346478,-0.266251,0.654752,0.658904,0.918381,-0.348953, &
            -0.235979,0.672860,0.394736,-0.670249,0.770377,0.448004,0.807792,-0.095015, &
            -0.267569,0.629350,0.632138,-0.677216,0.650315,0.329184,0.818239,0.046579, &
            -0.417670,0.616923,0.535746,-0.584712,0.315252,0.231127,0.649299,-0.029211, &
            -0.375644,0.697687,0.613148,-0.826769,0.405908,0.038426,0.475195,0.072507, &
            -0.214173,0.947539,0.765711,-0.958391,0.495127,-0.002740,0.649574,0.052988, &
            -0.118990,0.655777,0.847952,-0.671822,0.469100,-0.087440,0.671285,0.194120, &
            0.093769,0.631201,0.718645,-0.804277,0.740511,0.474650,0.649698,0.534984, &
            -0.214982,1.003645,0.959452,-0.760234,0.923003,0.515321,0.406801,0.656881, &
            0.400974,0.446501,0.469963,-0.331706,1.696171,1.666048,1.173110,-0.299450, &
            0.150950,-0.008479,0.081165,-0.519806,1.733948,1.427989,1.213837,-0.173183, &
            0.205909,0.053782,-0.060045,-0.230885,2.065259,0.982907,1.343333,-0.612382, &
            -0.238275,0.436373,-0.227119,-0.799629,1.454514,0.511572,1.023878,-1.045278, &
            -0.862948,0.654699,-0.445195,-0.323709,1.328773,-0.155229,0.348170,-0.879989, &
            -1.252657,0.859576,-0.369695,-0.388549,0.988752,-0.356143,0.571989,-0.651837, &
            -0.816552,0.923488,-0.525073,0.138229,1.613355,-0.105550,0.912791,-1.149004, &
            -1.631089,0.856401,0.063614,-0.691448,1.340969,-0.327435,0.211245,-0.495376, &
            0.227532,-0.173029,-0.412250,0.242827,-0.085495,0.089404,-0.236743,-0.049515, &
            0.200461,0.016466,0.049774,0.116214,-0.403277,0.055459,-0.309467,0.055150, &
            0.122559,-0.129613,0.083406,0.114052,-0.354223,-0.019346,-0.034394,-0.136289, &
            -0.026273,0.110425,-0.084779,0.073730,-0.001351,0.211884,-0.305984,0.125844, &
            0.153514,-0.003249,0.018219,0.014280,-0.251376,-0.056509,0.110545,-0.145090, &
            -0.110755,-0.041380,0.064857,0.024279,0.104944,-0.038024,-0.090786,0.147120, &
            -0.069604,0.161614,-0.049753,0.021223,0.046848,-0.215985,0.087504,-0.128467, &
            0.156621,-0.197735,-0.057239,-0.322033,-0.357783,-0.189615,0.232814,-0.251774, &
            0.391947,-0.237041,-0.325238,0.105357,-0.200141,-0.512947,0.748724,-0.307420, &
            -0.537120,0.519281,0.101552,-0.490429,-0.021728,-1.898301,0.710305,-0.099624, &
            0.370632,-0.448504,0.047834,0.433874,0.004670,-0.891575,0.475912,0.110964, &
            -0.236139,-0.355227,0.329620,0.157732,-0.059267,-1.642113,0.340859,0.164165, &
            -0.246883,-0.242955,-0.077651,0.220526,0.076339,-1.075854,0.796397,-0.702050, &
            0.076180,0.372115,0.241134,-0.133989,-0.076850,-0.665455,-0.142855,-0.158820, &
            0.431741,-0.568805,-0.214023,0.611147,0.358435,0.300334,0.043007,0.706242, &
            0.003233,-0.501147,0.645645,-0.052634,-0.448197,0.545881,-0.606260,1.342974, &
            0.008567,0.104343,0.593925,-0.325509,0.182882,0.238757,0.144321,0.049974, &
            0.290788,0.125951,0.474495,-0.294916,0.104434,0.499979,-0.180426,0.179479, &
            0.335078,0.171491,-0.238216,-0.059589,-0.603954,-0.293010,-0.241871,0.260425, &
            0.469410,0.111937,-0.438723,-0.019123,-0.354249,-0.351751,-0.166939,0.036704, &
            0.033087,-0.060283,-0.376201,0.116854,-0.321011,-0.359241,-0.016280,0.321159, &
            0.321341,0.086225,-0.064335,0.183651,-0.351664,-0.541952,-0.457349,0.363256, &
            -0.036410,-0.089081,-0.308265,0.052823,-0.245696,-0.193290,-0.407988,0.217439, &
            -0.022081,-0.199933,-0.378548,-0.033503,-0.384165,-0.151017,-0.497075,0.392390, &
            -0.014998,-0.015892,-0.175370,0.195997,-0.028391,-0.150317,-0.513289,0.476802, &
            -0.088175,-0.217008,-0.302878,0.170530,-0.045186,-0.169572,-0.329073,0.429175, &
            0.140928,-0.598032,-0.596047,0.362197,-0.146722,-0.481662,-0.546342,0.419336, &
            0.377222,-0.738595,-0.531372,0.390993,0.104975,-0.389542,-0.720958,1.149685, &
            0.101981,-0.025285,-0.418908,0.222781,0.107305,-1.068169,-0.450342,1.577348, &
            0.296336,-0.130551,-0.413758,0.377558,0.282983,-0.215947,-0.544610,1.272795, &
            0.271609,0.070451,-0.123027,0.577708,-0.160335,-0.139468,-0.259781,1.044372, &
            0.285861,0.051220,-0.108224,0.223324,-0.170916,-0.004469,-0.211507,0.766703, &
            0.100036,0.216586,-0.304975,0.028695,-0.150769,0.578185,-0.418119,0.305140, &
            0.445086,0.258702,-0.270376,-0.218960,-0.101517,0.972896,-0.583187,-0.179137, &
            0.400942,0.183978,-0.301520,-0.043951,-0.312257,1.018146,-0.309145,-0.205217, &
            0.965390,0.437691,-0.202926,-0.147779,-0.364298,0.639871,-0.233183,0.194004, &
            -0.086473,-0.454926,0.143179,-0.097123,-0.060939,-0.208184,-0.075825,0.046660, &
            -0.138682,-0.223242,0.078513,-0.018686,-0.001329,0.071125,0.054589,0.056306, &
            -0.102568,-0.110347,-0.033882,-0.055245,0.079566,-0.075869,0.011762,-0.018322, &
            -0.007667,-0.107039,-0.053288,-0.080024,-0.033527,-0.020784,0.026680,-0.006819, &
            0.045287,0.026005,-0.095983,-0.066559,-0.026228,0.041760,0.060019,0.008615, &
            -0.050317,-0.002972,-0.094355,-0.032529,0.066789,-0.083367,0.013933,0.065351, &
            0.039034,-0.021418,-0.012257,-0.006347,-0.108274,-0.045911,0.011000,0.047702, &
            0.032030,-0.034439,-0.118717,-0.139699,-0.045401,0.043501,0.127335,-0.018990, &
            0.211018,0.287258,-0.000645,0.024996,-0.147754,0.143689,0.094011,-0.058646, &
            0.180892,-0.216779,-0.005940,-0.079403,-1.087163,-0.103056,0.780646,0.033023, &
            0.029983,-0.324932,-0.210684,-0.221417,-0.907635,-0.040111,0.781131,-0.004746, &
            0.099945,-0.196678,0.002480,-0.096788,-0.240895,0.012140,-0.053368,-0.202394, &
            0.377682,0.549605,0.176968,0.259004,0.011194,0.187113,-0.556019,0.108080, &
            0.060971,0.660094,0.312186,0.267955,0.446560,-0.157826,0.511204,-0.186477, &
            -0.065685,0.173128,-0.131595,-0.027372,-0.294210,0.168987,0.611308,0.056064, &
            -0.378560,-0.355496,0.003091,0.088263,-0.390467,0.209622,0.196863,0.111700, &
            -0.208303,-0.230561,-0.126510,-0.143770,0.437505,-0.323791,0.162113,0.153702, &
            -0.412548,-0.442876,-0.300791,-0.292331,-0.225775,0.209152,0.572351,0.075315 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-2.388087,-0.036471, &
            1.860576,-0.222056, &
            2.810586,0.557062, &
            -3.455164,-0.469418, &
            -0.831009,0.936518, &
            -3.757931,1.482206, &
            -0.601188,0.771488, &
            -0.510940,-1.722324 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-1.444647,0.685658/),(/1,2/))
real, dimension(8) :: bias1 = &
(/1.936849,-1.406974,-1.634428,1.388033,1.532658,0.955835,1.679566,-0.955687/)
real, dimension(2) :: bias2 = &
(/0.257893,0.11781/)
real, dimension(1) :: bias3 = &
(/0.888115/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
