module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
Reshape((/-0.054686,0.044802,-0.135276,-0.221930,0.018597,-0.007091,-0.067914,0.022134, &
            0.048275,-0.067678,-0.009492,-0.035229,0.220228,-0.009087,-0.298018,-0.025814, &
            -0.045260,0.065108,0.048604,-0.028927,0.121669,0.028649,-0.288241,-0.006076, &
            0.032423,-0.059407,-0.505955,-0.068068,-0.082431,0.065147,-0.052201,0.013660, &
            0.038246,-0.055598,-0.410105,0.134231,-0.156705,0.167502,-0.072180,0.088308, &
            -0.064007,-0.062288,-0.584933,-0.063360,0.010664,0.121152,-0.043006,0.015435, &
            0.029820,0.064361,-0.402624,-0.069364,0.126730,-0.058168,-0.012071,0.087112, &
            -0.023801,0.121286,-0.267796,0.022340,0.071804,0.054639,-0.195239,0.141352, &
            0.030639,0.287798,-0.117943,-0.429853,-0.120633,-0.382763,-0.364883,0.273636, &
            -0.220755,0.662116,1.027157,-0.253349,0.358816,-0.475763,0.271313,0.532481, &
            0.120687,0.862787,1.128802,-0.113101,-0.355477,-0.293891,0.157337,0.531208, &
            -0.194221,0.547483,0.452312,0.215060,-0.161612,0.057579,0.414601,0.301440, &
            -0.135455,0.470210,0.451850,-0.054960,0.471534,0.005724,-0.586554,0.109136, &
            -0.325950,0.917191,0.605729,-0.082090,0.209952,0.197905,-0.631483,0.144034, &
            -0.061173,0.496767,0.141644,-0.305147,0.593552,-0.078400,-0.473296,0.092219, &
            -0.014990,0.232858,-0.386593,-0.173553,0.979685,-0.201671,-0.634598,0.376931, &
            0.134607,0.334075,-0.143703,0.064800,0.987713,-0.047034,-0.366472,0.206449, &
            -0.176715,0.339494,0.172883,0.020344,0.295138,0.092369,-1.724699,0.187689, &
            0.152494,-0.079749,0.156608,0.097437,-0.080650,-0.117000,0.348238,-0.005384, &
            0.222384,-0.244481,-0.244126,0.129505,-0.028723,0.071961,0.446279,0.056136, &
            0.138202,-0.042966,-0.194276,-0.023597,-0.185334,-0.006090,0.526315,0.123369, &
            -0.093888,-0.136451,-0.508179,-0.159794,-0.245191,0.097136,0.321211,0.112377, &
            -0.141931,-0.258837,-0.451071,-0.034547,-0.173067,0.220043,0.283084,0.149414, &
            -0.102493,0.003054,-0.171869,-0.215681,-0.192455,0.121743,-0.154199,0.190788, &
            -0.072915,-0.247583,-0.225725,-0.149232,-0.044214,0.109886,0.290307,0.130569, &
            -0.147830,-0.220939,-0.118129,-0.282169,-0.048529,0.228454,0.613407,0.092344, &
            0.225417,-0.300980,-0.250008,-0.162911,-0.231343,0.533956,0.758721,-0.170839, &
            0.200309,-0.934829,-0.256905,-0.170910,-0.357929,0.254359,0.944182,-0.135748, &
            0.290193,-1.113161,-0.270332,-0.105075,-0.261401,0.174735,1.256861,-0.347364, &
            0.121697,-0.940232,-0.590324,0.019304,-1.001954,0.254227,1.556662,-0.184778, &
            -0.112388,-0.552330,-0.933226,-0.265035,-1.031093,0.032744,1.236093,0.014918, &
            -0.295079,-0.386195,-0.096174,-0.226276,0.189647,-0.043309,1.934705,-0.007864, &
            0.345182,-0.236226,0.521226,-0.376427,-0.403175,-0.196668,0.851350,-0.427892, &
            0.026574,0.036907,-0.104845,-0.612371,-0.339304,-0.001452,0.357623,-0.538629, &
            -0.420986,0.076354,0.015108,-0.528166,0.533900,0.159984,0.635888,-0.466084, &
            -0.352674,-0.733482,0.359758,-0.403190,-1.373516,-0.125012,0.645622,-0.025826, &
            3.073892,-2.328115,-0.985363,4.197793,-3.703537,-4.055405,1.292273,-3.092141, &
            3.022948,-2.322460,-0.928966,4.010384,-3.589012,-3.864081,1.442822,-3.073627, &
            3.103652,-1.964191,-0.835229,3.803361,-3.354611,-3.909591,1.329583,-2.963320, &
            3.074865,-1.926257,-0.746759,3.800385,-3.148965,-3.561570,0.988230,-2.743528, &
            2.928586,-1.879002,-0.724799,3.589466,-3.148784,-3.838834,0.947320,-2.983640, &
            2.630299,-1.361592,-0.934014,3.572213,-3.150861,-3.853488,1.103604,-2.943313, &
            2.706856,-1.368809,-1.137471,4.024134,-3.207626,-3.988117,0.775939,-3.134164, &
            2.499526,-1.165309,-1.092825,4.228792,-3.377881,-4.256760,0.507663,-3.451567, &
            1.124743,0.225015,-1.252833,5.258607,-4.243418,-5.631127,-0.070075,-4.644161, &
            1.766988,0.370249,-0.007350,5.084588,-3.507275,-4.846090,0.072050,-4.682185, &
            2.038085,0.693560,0.525225,4.737361,-2.682975,-3.803780,0.407198,-4.379925, &
            2.607964,0.406300,0.149828,3.190589,-1.914004,-1.881099,0.638613,-2.500885, &
            2.345233,-0.170779,-0.679394,2.115795,-1.278768,-1.235988,0.879308,-1.606644, &
            2.005145,-0.738988,-1.561987,1.110100,-0.625447,-1.141037,0.816334,-1.012323, &
            1.944917,-1.010781,-1.694965,0.169221,-0.256743,-0.822719,0.780897,-0.355864, &
            1.281589,-0.878774,-1.851829,0.044073,-0.655612,-0.804795,0.636553,-0.707134, &
            0.712910,-1.062613,-1.451002,0.336558,-0.917927,-0.381221,0.508938,-0.365492, &
            0.925638,-1.201693,-0.911744,0.770083,-1.118513,-0.481965,0.587807,-0.129675, &
            0.711438,-0.803962,-0.348846,1.206246,-0.322247,-0.520012,1.053134,-0.460878, &
            0.576391,-0.672691,-0.332718,1.021844,-0.477239,-0.517769,0.671847,-0.442805, &
            0.437007,-0.349494,-0.399991,1.229119,-0.545444,-0.297105,0.685257,-0.774206, &
            0.471968,-0.534254,0.034422,0.938837,-0.403121,-0.359266,0.868930,-0.710733, &
            0.306255,-0.494646,0.004246,1.154082,-0.427442,-0.611938,0.851642,-0.528365, &
            0.444578,-0.093023,-0.231871,0.838229,-0.361626,-0.392626,0.877696,-0.659758, &
            0.250431,-0.466360,-0.033246,1.010684,-0.133939,-0.600102,0.858264,-0.763902, &
            0.141666,-0.445930,0.005266,1.167353,-0.227998,-0.580318,0.800009,-0.599958, &
            0.056581,-0.311207,0.348031,1.018759,0.176768,-0.578985,0.838738,-0.523142, &
            0.031863,-0.474298,0.067713,0.819011,0.099269,-0.642002,1.185444,-0.668920, &
            0.326398,-0.419226,-0.063138,0.901836,0.054561,-0.588308,1.097233,-0.649776, &
            0.170491,-0.548328,-0.881115,0.473300,-0.120029,-0.820557,1.101846,-0.542749, &
            0.461117,-0.767014,-0.581951,0.178762,-0.006382,-0.332795,1.331064,-0.556157, &
            0.312319,-0.741661,-0.228299,-0.065391,0.452088,0.063947,1.540326,-0.224103, &
            0.090182,-0.592434,-0.111338,-0.186059,0.223548,0.237946,1.371264,-0.297945, &
            -0.052526,-0.332138,-0.530137,0.206317,-0.363077,-0.179140,1.130644,-0.838922, &
            0.212203,-0.513582,-0.502074,-0.034881,-0.536414,0.097019,0.700387,-0.678077, &
            0.142275,-0.782132,-0.302762,0.007486,-0.552124,-0.018256,0.605645,-0.480069, &
            -0.199722,0.330980,0.174618,-0.292030,0.461574,0.286152,-0.516786,0.295128, &
            -0.115061,0.670383,-0.032395,-0.110902,0.368708,0.054476,-0.834101,0.281303, &
            -0.084134,0.324351,0.372154,-0.010351,-0.017399,0.049119,-0.593526,0.253451, &
            0.040972,0.371267,0.067656,0.052187,0.412592,0.022769,-0.350497,0.115972, &
            -0.054845,0.201062,0.002407,-0.252756,0.243907,-0.163703,-0.111676,0.145581, &
            -0.055674,-0.006866,-0.074116,-0.031432,-0.149220,0.012148,-0.237368,0.014476, &
            -0.021975,-0.231350,-0.051858,0.030217,0.002492,-0.111262,-0.021640,-0.044303, &
            -0.027468,-0.336161,-0.247225,0.145378,-0.124418,0.108320,0.105403,-0.275002, &
            -0.272741,-0.520405,0.075127,-0.242654,0.068932,0.411194,0.507366,0.053513, &
            -0.364602,-0.380233,-0.489381,0.181626,-0.949045,-0.196116,-0.409626,-0.440869, &
            0.095745,-0.303941,-0.088956,-0.326929,-0.389397,0.266996,0.347584,0.450610, &
            -0.080934,-0.401619,-0.249934,-0.446230,-1.380742,0.014067,0.110528,-0.041809, &
            0.943788,-0.088938,0.128856,0.004160,-1.160117,0.030079,-1.009738,-0.091861, &
            0.080034,-0.373371,0.061201,0.075627,-1.173558,-0.420161,-0.417108,-0.331436, &
            -0.251764,-0.468524,-0.231129,-0.349589,-0.086794,0.321926,0.266902,0.501751, &
            -0.785008,0.374245,-0.310651,0.129275,-0.065676,-0.225516,0.031415,0.513780, &
            -0.030060,-0.534642,-0.527739,0.518004,0.185027,-0.572882,-0.154490,0.168077, &
            -0.151891,-0.258512,-0.077941,0.532390,0.450818,-0.311231,-0.310118,0.456927, &
            -0.158548,0.440000,0.267949,-0.196326,-0.290613,0.146017,-0.088709,-0.193274, &
            -0.075090,0.116401,0.275984,-0.088146,-0.157463,0.177793,-0.370847,0.086453, &
            -0.393464,0.212667,0.513897,-0.045994,-0.181732,0.180118,-0.062250,0.089316, &
            -0.116695,0.115882,0.212621,-0.180813,-0.191412,0.130982,-0.176161,-0.099831, &
            -0.395922,0.179923,0.276756,-0.133433,0.036512,0.126765,-0.137618,0.039670, &
            -0.184780,0.144025,0.336046,-0.143733,0.042916,0.020447,0.038174,-0.149182, &
            -0.302562,0.085209,-0.008541,-0.358474,0.131087,0.030463,0.125957,0.024353, &
            -0.472574,0.213133,-0.021129,-0.184202,0.329166,0.297677,0.346451,0.044290, &
            -0.485536,-0.149805,-0.096700,-0.646706,0.164635,0.610717,0.471632,0.353914, &
            -0.693067,0.227790,-0.063816,-0.728106,0.101784,0.369828,-0.029509,0.435142, &
            -0.846228,0.174492,-0.328568,-0.588313,-0.495395,0.443806,-0.089272,0.124915, &
            -0.431011,0.078735,-0.111148,-0.423150,-0.466985,0.459923,-0.316622,0.176650, &
            -0.508197,0.225811,-0.158261,-0.340661,-0.191212,0.240708,-0.342462,0.261599, &
            -0.444655,0.713667,-0.171189,0.119069,0.189449,0.067810,-0.074650,-0.152168, &
            -0.172382,0.237472,0.115169,-0.434794,0.635918,0.715976,-0.312279,0.535634, &
            -0.879708,0.962856,0.117060,0.337059,0.781995,0.393960,-0.324553,0.036845, &
            -0.578078,0.320100,0.531054,0.234921,0.958475,0.414433,0.121130,0.101388, &
            -0.658563,-0.008729,0.231098,0.230881,0.538075,0.455032,-0.007322,0.565746, &
            -0.005650,-0.071051,0.004403,-0.046426,-0.105097,-0.062756,0.034717,0.052610, &
            -0.010019,-0.064708,0.054718,-0.014368,0.137667,-0.009671,-0.028686,-0.054158, &
            0.012106,-0.017697,-0.060462,0.044592,0.104821,0.011764,-0.002283,0.003475, &
            -0.086939,-0.106990,0.019746,-0.034344,0.003941,0.079679,-0.067051,-0.128529, &
            0.028317,0.021327,0.174002,0.132098,0.010888,-0.086974,0.075721,0.157373, &
            0.064067,-0.035431,-0.320576,0.055171,0.161350,0.040818,0.090713,-0.024314, &
            0.036876,0.054975,-0.138675,0.039373,0.034009,-0.056092,0.030995,0.104193, &
            0.067816,-0.157925,-0.281008,-0.018232,0.166635,0.002717,-0.203425,-0.115778, &
            0.015708,-0.013636,-0.125333,0.065104,0.027826,0.151547,-0.462424,-0.098499, &
            -0.080898,0.087939,0.198698,-0.091733,-0.358444,-0.020391,0.073712,0.050713, &
            -0.024678,0.015608,0.050067,-0.052967,-0.063909,-0.098301,1.093330,-0.051006, &
            -0.046745,0.313196,0.141710,-0.134733,-0.137042,0.027508,-0.072148,0.048862, &
            0.047120,-0.023002,0.036393,0.119984,0.161399,-0.042274,-0.477404,0.096398, &
            0.022765,-0.067610,0.038620,0.021772,-0.049539,-0.057680,-0.031962,0.052606, &
            0.052181,0.013047,-0.045982,-0.175693,0.110111,-0.108137,0.098266,-0.047600, &
            -0.073201,0.230242,0.329025,-0.125414,-0.004011,0.022465,-0.092985,-0.087458, &
            -0.073144,0.075493,0.386661,0.091808,-0.018169,0.006256,-0.041200,0.063621, &
            0.117842,0.064541,-0.148238,0.032563,0.346025,-0.015359,-0.329789,-0.012798 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
Reshape((/-2.324930,0.177075, &
            1.223804,0.537899, &
            0.438668,-0.994813, &
            0.617318,2.254246, &
            -1.618233,-3.247275, &
            -1.014129,-4.666182, &
            -1.070548,-0.284008, &
            -0.685651,-2.309887 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
Reshape((/-1.21082,-1.536382/),(/1,2/))
real, dimension(8) :: bias1 = &
(/0.713635,-1.415298,0.585536,-1.113572,0.748828,1.218711,1.354488,1.351279/)
real, dimension(2) :: bias2 = &
(/-0.19616,0.222556/)
real, dimension(1) :: bias3 = &
(/1.565616/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  !layer1 = MatMul(input,inarray2)
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM

    