module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
Reshape((/1.000000,0.103400,-0.199466,0.213948,-0.030129,0.153179,0.016349,0.092224, &
            0.093596,-0.090866,-0.077771,0.087452,0.099614,0.034360,0.053924,0.018773, &
            0.007451,0.055440,0.085436,-0.077448,-0.074147,-0.106176,0.065152,-0.034436, &
            -0.217352,0.005648,-0.081997,0.059022,-0.106445,-0.054801,-0.012552,0.031253, &
            -0.267561,-0.006461,-0.055493,-0.034807,-0.266410,-0.099850,0.015030,0.155175, &
            -0.080103,-0.049725,-0.033756,0.034490,0.084701,-0.222640,-0.067216,-0.108701, &
            -0.036376,0.087121,0.171132,-0.176317,-0.117470,-0.020566,0.041496,0.084523, &
            -0.161106,0.077940,0.002177,0.138133,-0.177120,0.166514,0.103733,0.232174, &
            -0.161658,-0.289602,-0.336123,-0.251725,0.189116,1.650235,-0.056270,0.317932, &
            -0.074812,-0.177474,0.096304,-0.370110,0.454673,0.686010,-0.342539,0.303039, &
            -0.400762,-0.136285,0.190028,-0.643937,0.030473,0.314755,-0.138062,-0.173046, &
            -0.386053,-0.241125,0.005873,0.133642,-0.216205,-0.290451,0.002502,0.121393, &
            -0.128277,-0.201895,-0.168111,0.333887,-0.010830,0.026138,-0.039676,0.530463, &
            -0.034771,0.124651,0.014545,0.137377,-0.098021,0.104839,0.102260,0.144096, &
            -0.102423,-0.137387,0.089465,0.486448,0.323818,0.078386,0.091031,0.188494, &
            -0.106365,-0.335838,0.179659,-0.055379,0.174457,-0.046232,-0.100362,0.320186, &
            -0.009780,-0.342141,0.338076,-0.049013,0.432795,-0.578484,-0.260984,0.298256, &
            -0.138872,0.065358,-0.140355,0.078442,0.144886,-0.141985,-0.150331,-0.228327, &
            -0.014427,0.093441,0.027765,0.083181,0.121364,-0.004614,-0.030171,-0.021403, &
            0.124969,-0.005404,0.195894,-0.127608,0.276326,-0.155948,0.100083,-0.089143, &
            0.034587,-0.036014,0.105350,-0.125941,-0.023874,0.025651,0.058973,0.306531, &
            0.163173,-0.030473,-0.102153,-0.085694,0.208109,0.361734,0.121704,-0.088108, &
            -0.169209,0.078435,0.030913,-0.007608,-0.028446,0.188101,0.239335,0.135565, &
            -0.097664,0.166245,-0.214012,0.034744,0.126916,0.157294,0.019242,0.126524, &
            -0.166335,0.100208,-0.040371,-0.112075,0.102091,-0.010068,0.083912,0.123183, &
            -0.304126,0.065810,-0.219285,-0.196654,0.206597,0.033204,-0.010294,0.122016, &
            -0.407544,-0.019675,-0.325107,-0.181001,0.067545,-0.538032,0.301352,0.001997, &
            -0.452395,0.263774,-0.430862,-0.220551,0.069519,0.038634,0.192934,0.145920, &
            -0.396548,0.195816,0.007900,-0.172425,-0.138786,-0.505817,0.303962,0.043340, &
            -0.044235,-0.034337,-0.396340,-0.288536,0.165043,0.247703,-0.051473,-0.083350, &
            0.065684,0.145544,-0.217366,0.092877,0.059535,0.701940,0.121948,0.044880, &
            0.317200,0.474497,-0.060640,0.364068,0.098241,-0.055431,0.037104,0.149500, &
            0.374566,0.187633,-0.045074,0.291290,0.123741,0.364186,0.313847,-0.243872, &
            0.884098,0.477531,-0.121431,0.322017,0.066970,-0.025422,0.285932,-0.286154, &
            0.375603,0.517118,-0.379320,-0.028625,0.200405,-0.188155,-0.221290,-0.553603, &
            0.992223,0.488138,-0.720961,0.278486,0.163898,1.102360,-0.129476,0.129623, &
            2.530684,-2.513777,1.834047,1.914478,-2.009414,1.576031,-1.765861,-1.802958, &
            2.310739,-2.230305,1.706064,1.797911,-1.828632,1.743657,-1.658535,-2.117858, &
            2.304760,-2.418858,1.412570,1.668164,-1.575318,1.705165,-1.537422,-1.675768, &
            2.156992,-2.086845,1.593982,1.611571,-1.707602,1.503383,-1.868456,-1.853591, &
            2.215506,-2.172426,1.653708,1.692557,-1.594671,1.757820,-1.666878,-1.775905, &
            2.188301,-2.378962,1.640751,1.664498,-1.457857,1.960906,-2.013645,-1.827198, &
            2.260377,-2.548659,1.981253,2.106926,-1.918679,1.953601,-2.276439,-2.199316, &
            2.608307,-2.401914,2.251035,2.295505,-1.925530,2.125932,-2.439210,-2.123780, &
            3.919158,-3.793732,3.961062,3.844833,-3.747346,3.988661,-3.975205,-3.646200, &
            4.279296,-3.876499,3.795287,3.654883,-3.670744,3.263104,-3.674269,-3.679561, &
            3.526575,-4.043685,3.025302,2.481687,-3.188926,1.933937,-2.729528,-3.126525, &
            2.279279,-2.882105,1.094378,0.750221,-1.975450,0.699501,-0.947093,-1.724165, &
            1.383451,-1.940426,0.523346,0.431626,-1.384680,0.547391,-0.343570,-1.017102, &
            0.877796,-0.940525,0.556940,0.184358,-1.187865,0.491946,0.218930,-0.637319, &
            0.362632,-0.171288,0.183095,-0.094216,-0.611187,0.244354,0.325954,-0.394659, &
            0.309998,-0.111826,0.079500,-0.167917,-0.799236,0.247149,0.124326,-0.574642, &
            0.220344,-0.083305,-0.072078,-0.169628,-0.651419,0.126568,-0.064034,-0.537530, &
            0.197331,0.079004,-0.340665,0.059710,-0.129048,0.005446,-0.081920,0.103292, &
            0.169299,-0.235605,0.262437,0.155695,-0.423301,-0.302719,-0.503376,-0.477450, &
            0.465232,-0.056176,0.515030,0.381418,-0.159110,-0.365153,-0.250003,-0.499577, &
            0.485070,-0.118986,0.272648,0.277021,-0.310991,-0.398260,-0.281909,-0.640656, &
            0.346261,-0.093221,0.313481,0.404192,-0.206331,-0.165145,-0.293210,-0.402242, &
            0.253605,-0.264081,0.420932,0.515243,-0.146650,-0.232872,-0.688175,-0.678168, &
            0.298357,-0.272978,0.513221,0.517420,-0.333105,-0.247156,-0.502562,-0.683158, &
            0.098905,0.002684,0.359634,0.263099,-0.375926,-0.266014,-0.681874,-0.549196, &
            0.102797,0.166114,0.522120,0.215347,-0.437827,-0.181894,-0.490130,-0.421575, &
            0.281789,0.062137,0.432062,0.315575,-0.258821,-0.537081,-0.730709,-0.275503, &
            0.627011,-0.216960,0.481391,0.350562,-0.545085,-0.066957,-0.575760,-0.490121, &
            0.618108,-0.587603,0.486673,0.198273,-0.614634,-0.049034,-0.488638,-0.445036, &
            0.763289,-0.763647,0.662403,-0.037100,-0.268041,-0.135677,-0.275764,-0.817719, &
            0.444762,-0.895825,0.591842,-0.127298,-0.365022,-0.285248,0.153074,-0.515231, &
            0.309857,-0.394752,0.361617,-0.241340,0.149104,-0.514995,0.190852,-0.156751, &
            0.001606,0.208780,0.079793,-0.000048,0.205719,-0.455899,0.084047,-0.123191, &
            0.122005,-0.050682,0.585647,0.401745,0.101940,-0.002040,-0.071791,-0.255206, &
            -0.047381,0.288116,-0.152312,0.147654,0.180865,-0.148746,0.124995,-0.239872, &
            -0.101259,-0.105789,-0.082747,0.856961,0.222815,-0.379634,0.001377,-0.058336, &
            -0.600594,-0.126557,-0.316956,-0.256675,0.308516,-0.164044,-0.034509,-0.287045, &
            -0.206610,-0.198676,-0.035232,-0.228111,0.084833,-0.006105,0.002364,-0.181703, &
            -0.227220,-0.054092,-0.186295,0.069654,0.037964,0.070388,-0.096765,0.124577, &
            0.073884,-0.072289,0.173130,-0.204488,0.040110,0.290560,0.126955,-0.052372, &
            -0.114730,-0.095194,-0.124950,-0.030280,-0.012208,0.213839,-0.047951,0.112528, &
            -0.018642,0.034889,0.091967,0.215310,0.052758,0.111907,0.052977,0.054622, &
            -0.087672,0.025925,-0.130714,-0.013999,-0.161100,0.003038,-0.017329,-0.031624, &
            -0.110850,-0.016679,-0.093103,0.057135,0.016692,-0.144812,-0.180863,-0.293688, &
            -0.362290,0.335778,-0.562170,-0.251209,0.252744,-0.102396,-0.103695,-0.434803, &
            0.111161,-0.328789,-0.166453,0.132311,-0.476499,0.504278,-0.290044,-0.967362, &
            -0.118346,0.152870,-0.300813,-0.292954,0.398048,-0.189515,0.305079,0.056168, &
            0.020816,-0.163395,-0.099949,-0.070915,-0.014524,0.798439,0.212781,-0.276632, &
            -0.215129,-0.507303,-0.285488,-0.491219,-0.100523,0.211010,0.256272,-0.252518, &
            0.064490,-0.204903,-0.163642,-0.104646,-0.214339,0.467605,-0.126674,-0.801754, &
            -0.354944,0.740670,-0.281563,-0.200805,0.214799,0.186408,0.276292,0.150009, &
            0.168400,-0.084383,0.234389,0.107078,-0.288513,0.191848,-0.379077,0.443316, &
            -0.248029,0.202946,-0.146001,0.121295,0.028898,0.056004,-0.365242,-0.475371, &
            -0.376744,0.093833,0.111482,-0.000067,-0.012779,0.059725,-0.191132,-0.155712, &
            0.205121,0.111140,0.067085,0.082880,-0.218669,0.086522,0.184624,0.026750, &
            -0.176221,0.018492,-0.057131,0.014872,0.019294,-0.035424,0.109964,-0.143855, &
            -0.177471,0.152171,-0.000528,0.001081,-0.232876,-0.124112,0.130058,0.012050, &
            -0.172722,0.000974,-0.098045,0.118160,0.017088,-0.010292,-0.054788,0.065528, &
            -0.076000,0.023664,0.115910,-0.259328,-0.064280,-0.053279,0.022271,0.015646, &
            0.095560,0.255730,-0.170696,0.028693,-0.069564,-0.048625,-0.031145,-0.010798, &
            -0.073368,0.147850,0.209592,-0.094958,-0.145907,0.027245,0.145456,0.261412, &
            -0.209410,0.305967,-0.094229,-0.171645,-0.071413,0.031918,-0.028356,0.210460, &
            -0.177513,0.454606,-0.425468,-0.178601,0.286250,-0.417975,0.257083,0.299018, &
            -0.419307,0.425643,-0.156294,-0.052445,0.077983,-0.208706,0.063127,0.199050, &
            -0.280744,0.166982,-0.069763,0.024024,-0.024785,0.329220,0.171993,-0.070059, &
            -0.273532,0.333370,-0.174788,0.083414,0.026830,0.316986,0.076415,0.070150, &
            0.052389,0.193024,-0.035508,0.336537,0.071006,0.164811,0.157435,0.275957, &
            0.319553,-0.111942,0.396924,0.007193,-0.150499,-0.196341,-0.132420,-0.024663, &
            -0.192230,0.308675,-0.056041,0.087887,0.426321,-0.613259,0.270891,0.349568, &
            0.035884,0.033899,0.612251,0.260293,-0.090144,-0.668953,-0.201026,-0.219156, &
            -0.306805,0.119728,0.138253,-0.118487,-0.071442,-1.082900,-0.061145,0.083704, &
            -0.402303,0.364441,0.096645,-0.069605,0.166250,-0.480232,-0.273753,0.288070, &
            0.019909,0.032106,-0.064718,-0.016468,0.046456,0.321018,-0.006271,0.024903, &
            -0.025665,-0.056329,0.011341,-0.088345,0.089545,-0.051732,-0.084073,-0.007667, &
            -0.158398,-0.008276,-0.025003,-0.006313,-0.097465,0.001958,-0.034539,0.072873, &
            -0.016892,-0.018250,0.017655,-0.058009,-0.096260,-0.167275,-0.012125,0.056732, &
            0.085618,0.125397,0.128682,-0.017100,0.101678,-0.127951,0.017062,-0.145425, &
            0.170873,0.007158,-0.032313,0.053331,-0.037099,0.000961,0.011215,0.100563, &
            0.017743,-0.011058,0.005905,-0.083887,-0.038923,-0.021671,-0.058205,0.080632, &
            -0.212380,0.032987,0.031878,0.093604,-0.048297,0.062788,0.042207,-0.084832, &
            -0.211493,-0.142263,-0.209338,0.191661,-0.241675,-0.088990,0.091130,0.072322, &
            0.004470,-0.051679,-0.104227,0.053231,0.027057,0.085585,-0.038237,0.045596, &
            0.251102,0.107058,0.391899,-0.025312,0.147695,-0.257598,0.057038,-0.002729, &
            -0.104128,-0.120815,0.012823,0.133613,0.032001,0.119996,0.124876,-0.087566, &
            -0.187349,-0.138387,0.055501,-0.143561,0.041828,-0.006264,-0.106775,0.035621, &
            -0.116754,0.040788,-0.212800,0.030996,-0.059408,0.068919,-0.154164,0.019438, &
            0.172158,0.003021,0.136965,0.067594,0.281878,0.186773,0.092917,-0.165602, &
            0.137107,-0.056952,0.443899,0.015739,0.069553,0.445810,0.390900,0.075722, &
            -0.029229,0.058012,0.274206,-0.059725,-0.015421,-0.325694,0.079490,-0.046959, &
            -0.305585,-0.186027,0.014025,-0.007888,0.257219,-0.006504,-0.100000,1.000000 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
Reshape((/2.657598,-1.467691, &
            -4.513573,1.980000, &
            0.715913,-1.826437, &
            0.242338,-1.538967, &
            -2.893194,2.745759, &
            0.902459,-1.118353, &
            -0.860000,3.461406, &
            -2.553886,2.761685 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
Reshape((/0.421701,2.762092/),(/1,2/))
real, dimension(8) :: bias1 = &
(/-1.504195,1.580047,-1.441686,-1.534102,1.453517,-1.639079,1.422606,1.434874/)
real, dimension(2) :: bias2 = &
(/-0.497886,0.308318/)
real, dimension(1) :: bias3 = &
(/-0.303609/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  !do i = 1, 126
  !  inarray2(i) = inarray(127-i)
  !end do
  !layer1 = MatMul(input,inarray2)
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM

    