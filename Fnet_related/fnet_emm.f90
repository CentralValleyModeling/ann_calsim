module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/-0.095605,0.605330,0.022677,0.145090,0.024903,-0.401359,-0.283176,-0.185648, &
            0.020796,0.006552,-0.131325,-0.607950,0.138651,-0.771320,0.661460,-0.626479, &
            -0.045780,0.745824,0.207912,0.447336,0.088982,0.474810,-0.207178,-0.070623, &
            -0.104650,-0.023830,0.049016,0.300003,-0.055070,0.537274,-0.101578,0.169019, &
            -0.145387,-0.288877,0.010749,0.649226,-0.103033,0.271294,-0.232064,-0.133066, &
            -0.013564,0.101184,0.099163,-0.247298,0.006114,0.098453,-0.124285,-0.011568, &
            -0.004597,-0.073441,0.067123,-0.476768,0.008076,0.111826,0.002136,0.083747, &
            0.155535,-0.263291,-0.230473,-1.006868,0.052514,0.030371,0.474214,0.392246, &
            -0.212365,1.221541,0.277797,2.874786,-0.136075,-1.265335,-1.410845,-0.219017, &
            0.016510,-0.071054,-0.001682,0.794734,-0.037669,0.179709,-0.649835,0.310525, &
            0.079850,0.554648,0.022461,-2.689007,0.119129,0.774200,1.440492,0.074470, &
            0.146039,-0.379126,-0.016160,0.558369,0.143220,-0.073775,-0.230965,-0.179728, &
            0.022126,0.701493,0.198918,-0.208275,0.116494,2.085706,-0.456978,-0.296178, &
            -0.124285,0.527410,-0.055195,0.682022,-0.094235,-1.091710,0.274387,0.442746, &
            0.168883,1.122045,0.023910,-1.163923,0.275518,1.194783,0.544278,-0.766448, &
            0.065146,-1.063990,-0.060150,0.632371,-0.086862,0.156945,-0.967721,0.623088, &
            0.207972,0.435108,-0.196135,1.373534,0.216927,-0.834285,-1.886462,-0.660177, &
            -0.076087,-0.264140,0.152631,1.859296,-0.090742,1.332224,-1.515958,0.340688, &
            0.004604,1.449817,0.967180,-0.797364,0.252605,1.301461,-0.188006,-0.147732, &
            0.030102,0.175035,0.056280,-3.713835,0.181739,0.023121,0.975292,0.555550, &
            0.109541,0.312098,-0.277899,-1.572794,0.223893,-0.620553,0.579253,0.662774, &
            -0.014185,-0.093057,-0.279739,-0.409200,0.093804,-1.221650,0.993297,0.498422, &
            -0.347801,0.094968,0.292214,0.482045,0.045112,-0.166119,0.342647,0.050817, &
            -0.470499,-0.119051,0.279339,0.851063,-0.020534,0.222913,-0.211060,-0.683600, &
            -0.547067,-1.171331,0.480752,1.399490,-0.056470,1.561627,-0.096407,-0.599462, &
            -0.410538,-1.421107,0.194624,-0.001083,-0.019165,-0.570418,-1.171100,-0.636830, &
            -0.450756,0.988909,-0.780275,0.765964,0.743514,2.266999,0.926559,0.289457, &
            -0.330686,1.078177,0.597897,-1.695452,0.694868,-1.171212,-0.036844,0.888558, &
            -0.227571,0.699127,1.213412,2.671968,0.481660,-4.602367,1.177307,-0.109271, &
            -0.495267,-0.647868,-0.203783,1.272427,-0.240055,-1.243349,0.793511,0.084975, &
            -0.682412,-1.146388,-0.032791,-3.650793,-0.479855,-0.729627,1.053334,-0.099187, &
            -0.190671,0.500190,0.793617,1.043107,-0.091116,-1.402001,-3.098478,0.165971, &
            0.208092,-1.221128,-1.068877,1.352043,-0.041898,-2.193911,1.795654,0.638134, &
            0.140942,-2.474081,0.020800,-2.050883,0.154646,0.539694,0.814437,-1.374423, &
            -0.361526,1.252259,1.066082,-1.733449,-0.070418,2.648920,-0.127628,-0.531860, &
            -0.579892,-2.495076,-0.665356,1.782216,-0.796108,-3.195570,0.809666,1.045066, &
            2.026622,-3.323940,-3.653865,-5.432043,-1.444243,-2.385246,2.470668,6.497669, &
            4.678225,-2.386627,-2.171065,-2.147458,-3.793320,-1.778797,4.621766,5.164742, &
            5.002508,-2.159029,-3.207248,-2.493453,-4.104962,-2.209819,4.076107,4.954324, &
            4.595806,-2.497260,-4.838891,-3.249495,-3.549097,-2.760114,3.295915,5.064338, &
            4.247131,-2.375979,-5.949219,-3.645044,-3.366896,-3.083010,2.184248,5.045663, &
            4.221714,-2.305160,-6.589794,-3.807823,-3.412872,-3.385187,2.122481,4.852071, &
            4.613726,-1.576594,-7.207715,-3.326328,-4.390007,-3.327617,2.513211,4.482074, &
            6.036903,-0.624235,-7.043186,-2.759234,-5.287070,-3.166538,2.922118,3.603406, &
            12.680508,4.331710,-3.696694,2.543410,-11.611011,2.338534,7.660031,-1.284698, &
            10.323098,2.689364,-9.348779,0.816739,-8.947973,1.573744,3.324065,0.395264, &
            6.170470,0.112052,-10.890779,-0.576002,-4.405477,0.769668,0.637616,1.579873, &
            2.615270,-2.160457,-5.273210,-2.024517,-2.165699,0.916388,0.023171,1.573298, &
            1.789338,-1.794775,-5.894398,-0.509028,-2.197793,1.451650,2.439986,1.554541, &
            0.978321,-1.556985,-3.101087,1.005092,-0.892242,1.496539,1.408842,2.761010, &
            0.253921,-2.503985,-0.169281,0.856708,0.123242,0.209965,0.712937,3.166847, &
            -0.582090,0.653306,-1.109955,0.307547,-0.829827,0.328118,1.510688,0.838073, &
            -0.575521,1.833732,-0.075347,1.346399,-1.074181,0.761587,2.599907,1.502779, &
            1.033526,-0.913320,-0.048306,2.743167,0.697044,-0.561519,3.394329,3.362295, &
            -0.345335,-1.355458,-2.690864,-1.004054,0.010306,-1.930824,-0.421425,1.396514, &
            0.521149,-0.936119,-1.329118,-0.653801,-0.681303,-0.963986,-0.324196,0.660917, &
            0.561461,-0.627893,-1.384366,-0.561505,-0.906699,-0.565151,-0.194673,0.642227, &
            0.588472,-0.862381,-1.583525,-0.649619,-0.868705,-0.688281,-0.377663,0.539298, &
            0.578383,-0.694333,-1.120772,-0.592963,-0.949019,-0.484794,-0.110090,0.519573, &
            0.981203,-0.334020,-0.595597,-0.375363,-1.082271,-0.041904,-0.169937,0.233186, &
            1.010671,-0.478748,0.249029,-0.716748,-1.152553,-0.330091,0.002241,0.142232, &
            1.187021,-0.675067,1.233155,-1.094996,-1.128065,-0.369224,-0.657349,0.311791, &
            1.762237,-1.516393,4.224662,-2.121259,-1.260895,-1.291721,-1.756849,0.104513, &
            2.362946,-0.708108,1.211775,-1.395087,-1.829053,-1.897546,-1.046624,0.080490, &
            0.653507,0.459402,-2.322561,-0.321244,-0.945473,-2.120337,-1.812829,1.122626, &
            0.646977,0.820581,-4.834745,1.632985,-1.157266,-1.430640,-0.042710,0.229635, &
            0.781297,-0.215358,-2.629219,-0.360583,-0.489623,-2.084670,-2.292943,0.057139, &
            0.277532,-1.025356,-0.263705,-1.378543,0.339462,-2.155381,-3.127836,0.858909, &
            0.079551,-0.353150,1.778040,-1.699099,1.072697,-2.090907,-3.493033,0.941200, &
            0.552155,2.390632,0.505807,-0.963475,-0.011296,-1.843590,-3.257470,0.105675, &
            0.014313,4.002985,-0.372897,-0.335717,-0.101294,-1.498397,-2.489144,-0.451489, &
            -0.572740,4.313197,-0.105750,0.991005,-0.404758,0.066780,-1.214428,-1.864707, &
            -0.817686,0.565271,-0.431150,-0.218107,-0.055042,-0.841757,-0.228984,-1.399252, &
            0.021964,0.022206,0.077538,1.128514,0.206032,-0.590099,-0.059425,-0.465019, &
            -0.139845,-0.076535,-0.216395,1.738740,0.072279,1.081464,-0.151192,-0.784689, &
            0.067739,-1.029106,-0.150210,0.348756,-0.001117,0.814475,-1.029997,-0.825539, &
            -0.196193,-0.297840,-0.068559,0.041498,-0.148330,-0.455657,-0.169097,-0.268825, &
            -0.076020,0.208377,-0.020486,0.325416,-0.162545,-1.033016,0.079124,0.209215, &
            -0.220038,-0.344957,0.146655,0.839962,-0.272835,-0.320977,0.122212,0.320893, &
            0.164829,1.125801,-0.429911,0.651573,-0.083118,-1.788237,-0.078443,0.254426, &
            -0.817070,1.524717,0.723765,1.428826,-0.315686,-3.019278,-1.022892,0.063906, &
            0.668788,0.903697,-0.024676,-0.642965,-0.470496,-4.899013,1.598962,-0.828945, &
            -0.393575,-1.413280,0.068955,1.267906,0.438920,-2.149558,-0.486697,0.821691, &
            -0.038153,-0.713507,0.323979,3.604136,0.068523,-2.445231,2.883494,2.582847, &
            0.363753,0.311347,-1.041607,-0.862596,0.668025,-1.766887,1.901521,-0.990300, &
            0.071749,0.965529,-0.221183,0.627016,-0.310752,-0.696363,1.813082,0.006424, &
            -0.830568,-1.282569,0.633228,-2.427091,0.150096,-0.806910,2.186505,0.222583, &
            0.508692,-1.643745,0.568822,1.162670,-0.158954,0.427528,1.169308,0.426260, &
            0.283693,2.931561,0.117049,-1.473950,-0.158449,-2.055716,-0.060931,-0.338355, &
            0.079119,0.798496,1.476720,-1.914420,0.210985,2.815291,1.276825,-0.586149, &
            0.157507,-0.320168,0.002211,-2.665128,0.137602,0.535247,-0.208976,-0.620046, &
            -0.266131,0.230924,-0.701209,-1.357341,0.008290,1.454485,-0.101226,-0.318279, &
            -0.064757,-0.086573,0.473161,-0.172571,0.035881,1.346599,0.280557,0.009292, &
            -0.289822,0.164597,0.692701,-0.281019,-0.009513,1.878590,0.863670,-0.292195, &
            -0.218400,0.344097,0.391788,-0.430936,0.074269,0.821426,0.283987,-0.159747, &
            -0.273554,0.301297,0.692082,-0.347660,-0.091954,0.726967,0.195298,0.037324, &
            -0.209063,0.276289,0.381883,0.455527,-0.004870,0.759823,0.030553,0.027971, &
            0.079750,-0.557166,0.104101,0.344686,0.075648,-0.607282,-0.388852,0.147040, &
            -0.579539,-0.086141,-0.088302,-0.179825,0.622352,-0.490979,-0.148622,0.225387, &
            -0.555401,1.288429,1.443975,1.937029,0.472213,3.394139,0.445171,-1.363383, &
            -0.418221,0.983548,1.478520,0.491539,0.276784,2.754578,0.646149,-2.336826, &
            -0.469838,0.708205,0.718672,-0.768060,-0.039215,0.959698,-0.576115,-1.573859, &
            -0.240544,0.689764,-0.060224,0.236405,-0.059901,-0.551309,0.298110,-1.404860, &
            0.051249,-0.170875,0.449155,0.016785,0.140847,-0.083051,-0.157078,-0.741993, &
            -0.398812,-0.476246,0.476162,0.886220,-0.045028,1.393968,-0.530742,-0.801182, &
            -0.192659,0.768364,0.007759,0.336449,-0.260003,0.794613,-0.742333,-0.997131, &
            0.344710,0.764745,0.480350,-1.040855,0.374294,-0.391582,-1.711877,-0.047806, &
            0.067670,0.549763,0.238697,-0.888700,0.091799,0.501319,-0.218993,-0.505773, &
            0.032614,0.497523,0.084429,-0.420332,0.103124,-0.327844,1.045553,-0.051531, &
            0.048834,-0.270380,-0.068294,0.181896,0.023837,0.062029,-0.196710,-0.087377, &
            0.041762,0.054773,0.052930,0.493581,0.048437,-1.481117,0.503547,-0.019282, &
            0.011593,0.011609,0.142844,-0.411252,-0.025861,-0.702429,-0.239769,0.051063, &
            0.025392,-0.241668,0.069580,-0.579229,0.002027,0.894185,-0.374497,-0.132559, &
            -0.020693,-0.431144,-0.013111,0.415649,-0.074621,1.574609,-0.749182,0.115897, &
            0.113461,-0.493964,-0.349378,-2.382741,-0.003279,-0.189894,0.139248,0.041220, &
            -0.054008,0.067581,0.161413,0.947832,-0.020727,0.228955,0.742573,-0.137511, &
            0.158588,1.438481,0.304633,1.117077,0.188617,0.772627,0.681670,0.404898, &
            0.108031,-0.828450,-0.285779,-2.571702,-0.066106,-1.190713,-0.450243,-0.120283, &
            0.012803,-1.250850,-0.080074,1.292718,-0.044509,-3.713515,0.187088,-0.463102, &
            0.081722,1.207509,-0.033618,-0.703696,0.016141,0.894049,-0.518935,0.757811, &
            -0.018073,-1.381796,-0.022418,1.340806,0.007618,-2.130817,0.150242,-0.831208, &
            0.079371,0.215304,0.096169,-0.976294,-0.041787,0.278330,-0.237314,0.890740, &
            -0.049812,0.263990,-0.373239,-0.152853,-0.061950,-0.116569,-0.293889,-0.035139, &
            -0.048611,-0.061508,0.333460,1.426040,0.049370,-0.381009,0.012330,-0.437818, &
            0.163155,-0.375443,-0.207872,-1.003189,0.074786,0.012905,-0.030689,0.073934, &
            -0.055761,1.023124,0.049315,0.299116,0.001361,-1.754978,0.019908,-0.225611 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-0.082147,-2.907882, &
            -1.088916,-0.783128, &
            2.113554,0.906406, &
            -1.520226,-1.355035, &
            -0.794039,5.321999, &
            -2.048662,-1.559753, &
            -0.286158,-1.257231, &
            -1.147577,0.667913 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-0.743239,2.535562/),(/1,2/))
real, dimension(8) :: bias1 = &
(/-3.825963,-5.756336,4.254015,-1.515854,4.592319,-0.36171,-1.246087,5.10475/)
real, dimension(2) :: bias2 = &
(/-0.6215,0.102258/)
real, dimension(1) :: bias3 = &
(/0.097132/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 126
  inarray2(i) = inarray(127-i)
  end do
  layer1 = MatMul(input,inarray)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
